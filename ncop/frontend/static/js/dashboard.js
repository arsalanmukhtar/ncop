(()=>{var e=class{constructor(){this.storagePrefix="ncop_",this.currentUser=null,this.defaultSettings={mapStyle:"streets-v12",mapCenter:[74.3,31.5],mapZoom:6,mapBearing:0,mapPitch:0,labelsEnabled:!0,userPanelVisible:!1,basemapPanelVisible:!1,theme:"default",autoSaveInterval:3e4,notifications:!0,lastLogin:null,lastActivity:null,sessionData:{}},this.init()}init(){window.USER_ID&&(this.currentUser=window.USER_ID),this.initializeUserSettings(),this.setupAutoSave(),console.log("\uD83D\uDDC4️ NCOP Storage Manager initialized for user:",this.currentUser)}getUserKey(e){return this.currentUser?`${this.storagePrefix}user_${this.currentUser}_${e}`:`${this.storagePrefix}guest_${e}`}initializeUserSettings(){let e=this.getAllSettings();e&&0!==Object.keys(e).length||(this.saveAllSettings(this.defaultSettings),console.log("\uD83D\uDCDD Initialized default settings for user"))}saveSetting(e,t){try{let a=this.getUserKey(e);localStorage.setItem(a,JSON.stringify({value:t,timestamp:Date.now(),user:this.currentUser})),console.log(`\u{1F4BE} Saved ${e}:`,t)}catch(e){console.error("❌ Error saving to localStorage:",e)}}getSetting(e,t=null){try{let a=this.getUserKey(e),i=localStorage.getItem(a);if(i)return JSON.parse(i).value;return void 0!==this.defaultSettings[e]?this.defaultSettings[e]:t}catch(a){return console.error("❌ Error reading from localStorage:",a),void 0!==this.defaultSettings[e]?this.defaultSettings[e]:t}}saveAllSettings(e){Object.keys(e).forEach(t=>{this.saveSetting(t,e[t])})}getAllSettings(){let e={};return Object.keys(this.defaultSettings).forEach(t=>{e[t]=this.getSetting(t)}),e}saveMapState(e){let t=e.getCenter(),a=e.getZoom(),i=e.getBearing(),s=e.getPitch();this.saveSetting("mapCenter",[t.lng,t.lat]),this.saveSetting("mapZoom",a),this.saveSetting("mapBearing",i),this.saveSetting("mapPitch",s),console.log("\uD83D\uDDFA️ Map state saved")}restoreMapState(e){let t=this.getSetting("mapCenter"),a=this.getSetting("mapZoom"),i=this.getSetting("mapBearing"),s=this.getSetting("mapPitch");t&&null!==a&&(e.jumpTo({center:t,zoom:a,bearing:i,pitch:s}),console.log("\uD83D\uDDFA️ Map state restored"))}saveMapStyle(e){this.saveSetting("mapStyle",e)}getMapStyle(){return this.getSetting("mapStyle")}saveLabelsState(e){this.saveSetting("labelsEnabled",e)}getLabelsState(){return this.getSetting("labelsEnabled")}saveUserPanelState(e){this.saveSetting("userPanelVisible",e)}getUserPanelState(){return this.getSetting("userPanelVisible")}saveBasemapPanelState(e){this.saveSetting("basemapPanelVisible",e)}getBasemapPanelState(){return this.getSetting("basemapPanelVisible")}saveSessionData(e,t){let a=this.getSetting("sessionData",{});a[e]={value:t,timestamp:Date.now()},this.saveSetting("sessionData",a)}getSessionData(e){let t=this.getSetting("sessionData",{});return t[e]?t[e].value:null}updateLastActivity(){this.saveSetting("lastActivity",Date.now())}updateLastLogin(){this.saveSetting("lastLogin",Date.now())}getLastActivity(){return this.getSetting("lastActivity")}getLastLogin(){return this.getSetting("lastLogin")}setupAutoSave(){setInterval(()=>{this.updateLastActivity()},this.getSetting("autoSaveInterval",3e4)),window.addEventListener("beforeunload",()=>{this.updateLastActivity()})}clearUserData(){let e=Object.keys(localStorage),t=this.getUserKey("");e.forEach(e=>{e.startsWith(t.slice(0,-1))&&localStorage.removeItem(e)}),console.log("\uD83D\uDDD1️ User data cleared")}exportSettings(){let e=this.getAllSettings();return JSON.stringify({user:this.currentUser,timestamp:Date.now(),version:"1.0",settings:e},null,2)}importSettings(e){try{let t=JSON.parse(e);if(t.settings)return this.saveAllSettings(t.settings),console.log("\uD83D\uDCE5 Settings imported successfully"),!0}catch(e){console.error("❌ Error importing settings:",e)}return!1}getStorageInfo(){let e=Object.keys(localStorage).filter(e=>e.startsWith(this.getUserKey(""))),t=0;return e.forEach(e=>{t+=localStorage.getItem(e).length}),{totalKeys:e.length,totalSize:t,sizeKB:(t/1024).toFixed(2),maxSize:"5-10MB (browser dependent)",keys:e}}static isAvailable(){try{let e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}};class t{#e;#t;constructor(e,t){this.#e=e,this.#t=t}toggleMapLabels(e){let t=this.#e.getStyle();t&&t.layers&&t.layers.forEach(t=>{"symbol"===t.type&&t.layout&&t.layout["text-field"]&&this.#e.setLayoutProperty(t.id,"visibility",e?"visible":"none")}),console.log(`\u{1F5FA}\u{FE0F} Map labels toggled: ${e?"visible":"none"}`)}changeMapProjection(e){try{this.#e.setProjection(e),console.log(`\u{1F30D} Changed projection to: ${e}`),this.#t&&this.#t.saveSetting("mapProjection",e)}catch(e){console.error("Error changing projection:",e),this.#e.setProjection("mercator")}}enableTerrain(){console.log("\uD83C\uDFD4️ Enabling 3D Terrain mode...");let e="mapbox-dem";if(!this.#e.getSource(e))try{this.#e.addSource(e,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14})}catch(e){console.warn("Error adding terrain source:",e)}try{this.#e.setTerrain({source:e,exaggeration:1.5})}catch(e){console.warn("Error setting terrain:",e)}this.#e.easeTo({pitch:80,bearing:-17.6,duration:1e3}),this.#t&&this.#t.saveSetting("terrainEnabled",!0)}disableTerrain(){console.log("\uD83D\uDDFA️ Switching to 2D mode...");try{this.#e.setTerrain(null)}catch(e){console.warn("Error removing terrain:",e)}setTimeout(()=>{try{this.#e.getSource("mapbox-dem")&&this.#e.removeSource("mapbox-dem")}catch(e){console.warn("Error removing terrain source:",e)}},200);let e=this.#t&&this.#t.getSetting("mapProjection")||"mercator";this.#e.easeTo({pitch:0,bearing:0,duration:1e3}),setTimeout(()=>{try{this.#e.setProjection(e),console.log("\uD83C\uDF0D Projection restored to:",e)}catch(e){console.warn("Error setting projection:",e),this.#e.setProjection("mercator")}},1200),this.#t&&this.#t.saveSetting("terrainEnabled",!1)}}class a{#e;#a;constructor(e,t,a){this.#e=e,this.#a=t,this.projectionPanel=a,this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="nav-controls-wrapper",t.innerHTML=`
            <div class="custom-nav-control" id="navControlsContainer">
                <button id="zoomIn" class="custom-nav-btn" title="Zoom In"><i data-lucide="plus"></i></button>
                <button id="zoomOut" class="custom-nav-btn" title="Zoom Out"><i data-lucide="minus"></i></button>
                <button id="resetBearing" class="custom-nav-btn" title="Reset Bearing"><i data-lucide="compass"></i></button>
                <button id="toggle3D" class="custom-nav-btn" title="Switch to 3D View (2D Mode)">
                    <span class="nav-text">3D</span>
                </button>
                <button id="projectionSwitch" class="custom-nav-btn" title="Map Projections"><i data-lucide="earth"></i></button>
                <button id="locate" class="custom-nav-btn" title="Find My Location"><i data-lucide="map-pin"></i></button>
                <button id="homeExtent" class="custom-nav-btn" title="Zoom to Pakistan"><i data-lucide="house"></i></button>
                <button id="navToggleBtn" class="nav-toggle-btn" title="Toggle Navigation Controls"><i data-lucide="chevron-left"></i></button>
            </div>
        `,e.appendChild(t),lucide.createIcons(),this.restoreToggle3DState(window.ncop_storage?.getSetting("terrainEnabled"))}addEventListeners(){document.getElementById("navToggleBtn")?.addEventListener("click",this.#i.bind(this)),document.getElementById("zoomIn")?.addEventListener("click",()=>this.#e.zoomIn({duration:300})),document.getElementById("zoomOut")?.addEventListener("click",()=>this.#e.zoomOut({duration:300})),document.getElementById("resetBearing")?.addEventListener("click",this.#s.bind(this)),document.getElementById("toggle3D")?.addEventListener("click",this.#o.bind(this)),document.getElementById("projectionSwitch")?.addEventListener("click",()=>this.projectionPanel.togglePanel()),document.getElementById("locate")?.addEventListener("click",this.#n.bind(this)),document.getElementById("homeExtent")?.addEventListener("click",this.#l.bind(this))}#i(){let e=document.getElementById("navControlsContainer").classList.toggle("collapsed"),t=document.getElementById("navToggleBtn")?.querySelector("i");t&&(t.setAttribute("data-lucide",e?"chevron-right":"chevron-left"),lucide.createIcons())}#s(){this.#e.easeTo({bearing:0,pitch:0,duration:500})}#o(){document.getElementById("toggle3D");let e=!window.ncop_storage?.getSetting("terrainEnabled");e?this.#a.enableTerrain():this.#a.disableTerrain(),this.restoreToggle3DState(e)}#n(){let e=[73.09896723226383,33.681421388232];this.#e.flyTo({center:e,zoom:14,duration:2e3}),new mapboxgl.Marker({color:"#ff0000"}).setLngLat(e).addTo(this.#e),console.log("\uD83C\uDFAF Zoomed to target location:",e)}#l(){this.#e.flyTo({center:[69.3451,30.3753],zoom:5,duration:2e3,essential:!0}),console.log("\uD83C\uDFE0 Zoomed to Pakistan extent")}restoreToggle3DState(e){let t=document.getElementById("toggle3D");t&&(e?(t.title="Switch to 2D View (3D Mode)",t.classList.add("terrain-active")):(t.title="Switch to 3D View (2D Mode)",t.classList.remove("terrain-active")))}}class i{#e;#a;#r;#t=window.ncop_storage;constructor(e,t){this.#e=e,this.#a=t,this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=this.#t?this.#t.getSetting("mapProjection"):"mercator";this.#r=document.createElement("div"),this.#r.id="projectionPanel",this.#r.className="projection-panel",this.#r.innerHTML=`
            <div class="projection-header">
                <h3>Map Projections</h3>
                <button id="projectionClose" class="projection-close-btn"><i data-lucide="x"></i></button>
            </div>
            <div class="projection-list">
                ${[{key:"mercator",name:"Mercator",desc:"Standard web map projection",emoji:"\uD83C\uDF0D"},{key:"globe",name:"Globe",desc:"3D globe view",emoji:"\uD83C\uDF10"},{key:"albers",name:"Albers",desc:"Equal-area conic projection",emoji:"\uD83D\uDDFA️"},{key:"equalEarth",name:"Equal Earth",desc:"Equal-area pseudocylindrical",emoji:"\uD83C\uDF0E"},{key:"naturalEarth",name:"Natural Earth",desc:"Compromise pseudocylindrical",emoji:"\uD83C\uDF0F"},{key:"winkelTripel",name:"Winkel Tripel",desc:"Modified azimuthal projection",emoji:"\uD83D\uDDFA️"}].map(e=>`
                    <div class="projection-item ${e.key===t?"active":""}" data-projection="${e.key}">
                        <div class="projection-preview">${e.emoji}</div>
                        <div class="projection-info">
                            <div class="projection-name">${e.name}</div>
                            <div class="projection-desc">${e.desc}</div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `,e.appendChild(this.#r),lucide.createIcons()}addEventListeners(){document.getElementById("projectionClose")?.addEventListener("click",()=>{this.#r.classList.remove("visible")}),this.#r.querySelectorAll(".projection-item").forEach(e=>{e.addEventListener("click",this.#c.bind(this,e))}),document.addEventListener("click",this.#d.bind(this))}#c(e){let t=e.dataset.projection;this.#a.changeMapProjection(t),this.#r.querySelectorAll(".projection-item").forEach(e=>e.classList.remove("active")),e.classList.add("active"),setTimeout(()=>{this.#r.classList.remove("visible")},500)}updateActiveProjection(){let e=this.#t&&this.#t.getSetting("mapProjection")||"mercator";this.#r.querySelectorAll(".projection-item").forEach(t=>{t.classList.remove("active"),t.dataset.projection===e&&t.classList.add("active")})}togglePanel(){this.#r&&(this.#r.classList.contains("visible")||this.updateActiveProjection(),this.#r.classList.toggle("visible"))}#d(e){let t=document.getElementById("projectionSwitch");this.#r.contains(e.target)||t.contains(e.target)||this.#r.classList.remove("visible")}}class s{#e;#t=window.ncop_storage;#a;#g=[{id:"streets-v12",name:"Streets",emoji:"\uD83C\uDFD9️"},{id:"satellite-streets-v12",name:"Satellite",emoji:"\uD83D\uDEF0️"},{id:"outdoors-v12",name:"Outdoors",emoji:"\uD83C\uDFD4️"},{id:"light-v11",name:"Light",emoji:"☀️"},{id:"dark-v11",name:"Dark",emoji:"\uD83C\uDF19"},{id:"satellite-v9",name:"Satellite Only",emoji:"\uD83D\uDCE1"},{id:"navigation-day-v1",name:"Navigation Day",emoji:"\uD83D\uDDFA️"},{id:"navigation-night-v1",name:"Navigation Night",emoji:"\uD83C\uDF03"}];#h;#m;constructor(e,t){this.#e=e,this.#a=t,this.#h=this.#t?this.#t.getMapStyle():"streets-v12",this.#m=!this.#t||this.#t.getLabelsState(),this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="custom-basemap-control",t.innerHTML=`
            <button id="basemapToggle" class="custom-basemap-btn" title="Change Basemap">
                <i data-lucide="layers"></i>
            </button>
            <div id="basemapPanel" class="basemap-panel">
                <div class="labels-toggle">
                    <span class="labels-toggle-text">Show Labels</span>
                    <div class="toggle-switch ${this.#m?"active":""}" id="labelsToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="basemap-list" id="basemapList">
                    ${this.#g.map(e=>`
                        <div class="basemap-item ${e.id===this.#h?"active":""}" data-style="${e.id}">
                            <div class="basemap-image">${e.emoji}</div>
                            <span class="basemap-name">${e.name}</span>
                        </div>
                    `).join("")}
                </div>
            </div>
        `,e.appendChild(t),lucide.createIcons()}addEventListeners(){let e=document.getElementById("basemapToggle"),t=document.getElementById("basemapPanel"),a=document.getElementById("labelsToggle"),i=document.getElementById("basemapList");e?.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("visible")}),a?.addEventListener("click",this.#u.bind(this)),i?.addEventListener("click",this.#p.bind(this)),document.addEventListener("click",this.#d.bind(this));let s=document.getElementById("userPanel");s&&this.#v(s)}#u(){this.#m=!this.#m,document.getElementById("labelsToggle").classList.toggle("active",this.#m),this.#t&&this.#t.saveLabelsState(this.#m),this.#a.toggleMapLabels(this.#m)}#p(e){let t=e.target.closest(".basemap-item");if(t){let e=t.dataset.style,a=document.getElementById("basemapPanel");document.querySelectorAll(".basemap-item").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),this.#e.setStyle(`mapbox://styles/mapbox/${e}`),this.#h=e,this.#t&&this.#t.saveMapStyle(e),a.classList.remove("visible"),this.#e.once("styledata",()=>{this.#m||this.#a.toggleMapLabels(!1)})}}#d(e){let t=document.getElementById("basemapToggle"),a=document.getElementById("basemapPanel");a.contains(e.target)||t.contains(e.target)||a.classList.remove("visible")}#v(e){let t=document.querySelector(".custom-basemap-control"),a=document.getElementById("basemapPanel");new MutationObserver(i=>{i.forEach(i=>{"attributes"===i.type&&"class"===i.attributeName&&(e.classList.contains("user-panel-visible")?(t.classList.add("panel-open"),a.classList.remove("visible")):t.classList.remove("panel-open"))})}).observe(e,{attributes:!0})}}class o{#b;#S;#y;#t=window.ncop_storage;constructor(){this.renderButton(),this.#b=document.getElementById("sidebarPanel"),this.#y=this.#b?.querySelector(".accordion-container"),this.loadSidebarConfig(),this.addEventListeners(),console.log("\uD83D\uDCCB Sidebar menu initialized")}renderButton(){let e=document.getElementById("map");this.#S=document.createElement("div"),this.#S.className="custom-menu-control",this.#S.innerHTML=`
            <button id="menuToggle" class="custom-menu-btn" title="Open Menu">
                <i data-lucide="menu"></i>
            </button>
        `,e.appendChild(this.#S),lucide.createIcons()}addEventListeners(){document.getElementById("menuToggle")?.addEventListener("click",this.openSidebar.bind(this)),document.getElementById("sidebarCloseBtn")?.addEventListener("click",this.closeSidebar.bind(this)),document.addEventListener("keydown",this.#E.bind(this))}openSidebar(){this.#b?.classList.add("visible"),this.#S?.classList.add("hidden")}closeSidebar(){this.#b?.classList.remove("visible"),this.#S?.classList.remove("hidden")}#E(e){"Escape"===e.key&&this.#b?.classList.contains("visible")&&this.closeSidebar()}async loadSidebarConfig(){try{let e=await fetch("/static/data/ncop_menu.json"),t=await e.json();t&&this.#D(t)}catch(e){console.error("Error loading NCOP menu configuration:",e),this.#L()}}#D(e){this.#y&&(this.#y.innerHTML="",Object.keys(e).forEach(t=>{let a=e[t],i=this.#C(t,a);this.#y.appendChild(i)}),lucide.createIcons(),this.#f(),this.#w(),setTimeout(()=>{this.#P()},100))}#j(e){return({gis_layers:{title:"GIS Layers",icon:"layers",customIcon:"/static/icons/accordion_icons/gis-layers.webp"},weather:{title:"Weather Systems",icon:"cloud",customIcon:"/static/icons/accordion_icons/weather-systems.webp"},flood:{title:"Flood Monitoring",icon:"waves",customIcon:"/static/icons/accordion_icons/flood.webp"},air_quality:{title:"Air Quality",icon:"wind",customIcon:"/static/icons/accordion_icons/air-quality.webp"},"ocean/coastal":{title:"Ocean & Coastal",icon:"anchor",customIcon:"/static/icons/accordion_icons/ocean-coastal.webp"},"Disaster Early Warning (DEW)":{title:"Early Warning",icon:"alert-triangle",customIcon:"/static/icons/accordion_icons/early-warning.webp"}})[e]||{title:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),icon:"folder"}}#C(e,t){let a=document.createElement("div");a.className="accordion-item";let i=this.#j(e),s=i.customIcon?`<img src="${i.customIcon}" alt="${i.title}" class="accordion-custom-icon">`:`<i data-lucide="${i.icon}" class="accordion-icon"></i>`,o=document.createElement("div");o.className="accordion-header",o.innerHTML=`${s}<span class="accordion-title">${i.title}</span><i data-lucide="chevron-down" class="accordion-chevron"></i>`;let n=document.createElement("div");return n.className="accordion-content",Object.keys(t).forEach(e=>{let a=t[e];n.appendChild(this.#I(e,a))}),a.appendChild(o),a.appendChild(n),a}#I(e,t){let a=document.createElement("div");a.className="ncop-subcategory";let i=document.createElement("div");i.className="ncop-subcategory-header",i.innerHTML=`<span>${e}</span><i data-lucide="chevron-right" class="subcategory-chevron"></i>`;let s=document.createElement("div");return s.className="ncop-items-container",Object.keys(t).forEach(e=>{s.appendChild(this.#T(t[e],e))}),i.addEventListener("click",function(){let e=this.classList.contains("expanded"),t=this.closest(".accordion-content"),a=t?.querySelectorAll(".ncop-subcategory-header");a?.forEach(e=>{e!==this&&(e.classList.remove("expanded"),e.nextElementSibling?.classList.remove("visible"))}),e?(this.classList.remove("expanded"),s.classList.remove("visible")):(this.classList.add("expanded"),s.classList.add("visible"))}),a.appendChild(i),a.appendChild(s),a}#T(e,t){let a=document.createElement("div");a.className="ncop-item";let i="";"toggle"===e.type?i=`<label class="ncop-toggle"><input type="checkbox" data-endpoint="${e.endpoint}" data-item-key="${t}"><span class="ncop-toggle-slider"></span></label>`:"dropdown"===e.type&&(i=`
                <select class="ncop-dropdown" data-endpoint="${e.endpoint}" data-item-key="${t}">
                    <option value="">Select Option</option>
                    <option value="option1">Option 1</option>
                    <option value="option2">Option 2</option>
                    <option value="option3">Option 3</option>
                </select>
            `),a.innerHTML=`
            ${e.image&&""!==e.image.trim()?`<div class="ncop-item-image"><img src="${e.image}" alt="${e.label}" loading="lazy"></div>`:""}
            <div class="ncop-item-content">
                <div class="ncop-item-label">${e.label}</div>
                <div class="ncop-item-control">${i}</div>
            </div>
        `;let s=a.querySelector('input[type="checkbox"]'),o=a.querySelector("select");return s&&s.addEventListener("change",e=>this.#k(e.target.dataset.endpoint,e.target.dataset.itemKey,e.target.checked)),o&&o.addEventListener("change",e=>this.#x(e.target.dataset.endpoint,e.target.dataset.itemKey,e.target.value)),a}#f(){document.querySelectorAll(".accordion-header").forEach(e=>{e.addEventListener("click",function(){let e=this.nextElementSibling,t=this.classList.contains("active");document.querySelectorAll(".accordion-header").forEach(e=>{e!==this&&(e.classList.remove("active"),e.nextElementSibling?.classList.remove("expanded"))}),this.classList.toggle("active",!t),e?.classList.toggle("expanded",!t)})})}#L(){this.#y&&(this.#y.innerHTML=`
            <div class="accordion-item">
                <div class="accordion-header">
                    <i data-lucide="settings"></i>
                    <span>System Menu</span>
                    <i data-lucide="chevron-down" class="accordion-chevron"></i>
                </div>
                <div class="accordion-content">
                    <ul class="accordion-items">
                        <li class="accordion-item-entry" data-action="exportData">
                            <i data-lucide="download"></i><span>Export Settings</span>
                        </li>
                        <li class="accordion-item-entry" data-action="showHelp">
                            <i data-lucide="help-circle"></i><span>Help & Support</span>
                        </li>
                    </ul>
                </div>
            </div>
        `,this.#f(),lucide.createIcons())}#k(e,t,a){console.log(`\u{1F504} NCOP Toggle - ${t}:`,{endpoint:e,enabled:a}),this.#t&&this.#t.saveSetting(`ncop_toggle_${t}`,a);let i=a?"enabled":"disabled";console.log(`\u{1F4E1} ${t} has been ${i}`)}#x(e,t,a){if(console.log(`\u{1F4CB} NCOP Dropdown - ${t}:`,{endpoint:e,value:a}),this.#t&&this.#t.saveSetting(`ncop_dropdown_${t}`,a),""===a)return void console.log(`\u{1F4CB} ${t} selection cleared`);console.log(`\u{1F4CA} ${t} set to: ${a}`)}#P(){this.#t&&(document.querySelectorAll('.ncop-toggle input[type="checkbox"]').forEach(e=>{let t=e.dataset.itemKey,a=this.#t.getSetting(`ncop_toggle_${t}`);null!==a&&(e.checked=a)}),document.querySelectorAll(".ncop-dropdown").forEach(e=>{let t=e.dataset.itemKey,a=this.#t.getSetting(`ncop_dropdown_${t}`);null!==a&&(e.value=a)}),console.log("\uD83D\uDD04 NCOP control states restored from localStorage"))}#w(){let e=document.getElementById("sidebarSearch"),t=document.getElementById("clearSearch");e&&t&&(e.addEventListener("input",e=>{let a=e.target.value.toLowerCase().trim();a?(t.style.display="flex",this.#B(a)):(t.style.display="none",this.#M())}),t.addEventListener("click",()=>{e.value="",t.style.display="none",this.#M()}))}#B(e){let t=this.#y;if(!t)return;let a=0;t.querySelectorAll(".accordion-item").forEach(t=>{let i=!1,s=t.querySelector(".accordion-header"),o=t.querySelector(".accordion-content"),n=s.querySelector("span"),l=n?.textContent.toLowerCase()||"",r=l.includes(e);r&&(i=!0);let c=t.querySelectorAll(".ncop-subcategory"),d=0;c.forEach(t=>{let a=!1,s=t.querySelector(".ncop-subcategory-header"),o=s?.querySelector("span"),n=o?o.textContent.toLowerCase():"",r=t.querySelector(".ncop-items-container");n.includes(e)&&(a=!0,i=!0);let c=t.querySelectorAll(".ncop-item"),g=0;c.forEach(t=>{let s=t.querySelector(".ncop-item-label"),o=s?s.textContent.toLowerCase():"",r=t.querySelector('input[type="checkbox"]'),c=t.querySelector("select");[o,r&&r.dataset.endpoint||"",c&&c.dataset.endpoint||"",n,l].join(" ").toLowerCase().includes(e)?(t.style.display="flex",g++,a=!0,i=!0,this.#A(s,e)):(t.style.display="none",this.#N(s))}),a?(t.style.display="block",d++,n.includes(e)?this.#A(o,e):this.#N(o),r&&s&&g>0&&(r.classList.add("visible"),s.classList.add("expanded"))):(t.style.display="none",this.#N(o))}),i?(t.style.display="block",a++,o&&d>0&&(o.classList.add("expanded"),s.classList.add("active")),r&&n?this.#A(n,e):n&&this.#N(n)):(t.style.display="none",n&&this.#N(n))}),0===a?this.#O():this.#$()}#M(){let e=this.#y;e&&(e.querySelectorAll(".accordion-item").forEach(e=>{e.style.display="block";let t=e.querySelector(".accordion-header"),a=e.querySelector(".accordion-content"),i=t.querySelector("span");this.#N(i),t.classList.remove("active"),a.classList.remove("expanded"),e.querySelectorAll(".ncop-subcategory").forEach(e=>{e.style.display="block";let t=e.querySelector(".ncop-subcategory-header"),a=t?.querySelector("span"),i=e.querySelector(".ncop-items-container");this.#N(a),t?.classList.remove("expanded"),i?.classList.remove("visible"),e.querySelectorAll(".ncop-item").forEach(e=>{e.style.display="flex";let t=e.querySelector(".ncop-item-label");this.#N(t)})})}),this.#$())}#A(e,t){if(!e||!t)return;this.#N(e);let a=e.textContent,i=RegExp(`(${t})`,"gi");e.innerHTML=a.replace(i,'<span class="search-highlight">$1</span>')}#N(e){if(e&&(e.querySelectorAll(".search-highlight").forEach(e=>{let t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}),e.classList.contains("search-highlight"))){let t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}}#O(){if(this.#$(),this.#y){let e=document.createElement("div");e.className="no-results-message",e.innerHTML="<p>No results found</p><small>Try different keywords or check spelling</small>",this.#y.appendChild(e),lucide.createIcons()}}#$(){document.querySelector(".no-results-message")?.remove()}}class n{#t=window.ncop_storage;constructor(){this.#q(),this.#_(),this.#F()}#q(){window.ncop_utils={exportSettings:this.exportSettings.bind(this),importSettings:this.importSettings.bind(this),clearAllData:this.clearAllData.bind(this),showStorageInfo:this.showStorageInfo.bind(this),resetToDefaults:this.resetToDefaults.bind(this)}}#_(){document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.shiftKey)switch(e.key){case"E":e.preventDefault(),this.exportSettings();break;case"I":e.preventDefault(),this.importSettings();break;case"D":e.preventDefault(),this.showStorageInfo()}})}#F(){console.log("\uD83D\uDD27 NCOP Utilities loaded. Available commands: (ncop_utils.[command])")}exportSettings(){if(this.#t){let e=new Blob([this.#t.exportSettings()],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`ncop-settings-${new Date().toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(t),console.log("\uD83D\uDCE5 Settings exported")}}importSettings(){let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{let t=e.target.result;this.#t&&this.#t.importSettings(t)?alert("Settings imported successfully! Please refresh the page."):alert("Failed to import settings. Please check the file format.")},e.readAsText(t)}},e.click()}clearAllData(){confirm("Are you sure you want to clear all saved data? This cannot be undone.")&&this.#t&&(this.#t.clearUserData(),alert("All data cleared! Please refresh the page."))}showStorageInfo(){if(this.#t){let e=this.#t.getStorageInfo();console.table(e),alert(`
Storage Information:
- Total Keys: ${e.totalKeys}
- Total Size: ${e.sizeKB} KB
- Max Size: ${e.maxSize}
- User: ${window.USERNAME||"Guest"}
            `)}}resetToDefaults(){confirm("Reset all settings to defaults? This will clear your preferences.")&&this.#t&&(this.#t.clearUserData(),this.#t.initializeUserSettings(),alert("Settings reset to defaults! Please refresh the page."))}}class l{constructor(){this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="custom-user-control",t.innerHTML=`
            <button id="userToggle" class="custom-user-btn" title="User Info">
                <i data-lucide="user"></i>
            </button>
        `,e.appendChild(t),lucide.createIcons()}addEventListeners(){let e=document.getElementById("userToggle"),t=document.getElementById("userPanel");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("user-panel-visible")}),document.addEventListener("click",function(a){t.contains(a.target)||e.contains(a.target)||t.classList.remove("user-panel-visible")}))}}window.ncop_storage=null,e.isAvailable()?window.ncop_storage=new e:console.warn("⚠️ LocalStorage not available - user preferences will not be saved");class r{#e;#t=window.ncop_storage;#a;init(){if(!window.MAPBOX_ACCESS_TOKEN)return void console.error("Mapbox access token not found. Please check your environment configuration.");mapboxgl.accessToken=window.MAPBOX_ACCESS_TOKEN,this.#z(),this.#e.on("load",this.#U.bind(this)),this.#e.on("moveend",this.#H.bind(this)),this.#e.on("error",e=>console.error("Map error:",e)),this.#a=new t(this.#e,this.#t);let e=new i(this.#e,this.#a);new a(this.#e,this.#a,e),new l,new s(this.#e,this.#a),new o,new n,this.#t&&this.#t.updateLastLogin(),console.log("Dashboard initialized using a modular, class-based structure.")}#z(){let e=this.#t?this.#t.getMapStyle():"streets-v12",t=this.#t?this.#t.getSetting("mapCenter"):[74.3,31.5],a=this.#t?this.#t.getSetting("mapZoom"):6,i=this.#t?this.#t.getSetting("mapProjection"):"mercator";this.#e=new mapboxgl.Map({container:"map",style:`mapbox://styles/mapbox/${e}`,center:t,zoom:a,projection:i||"mercator",hash:!0})}#U(){if(console.log("Map loaded successfully"),this.#t){let e=this.#t.getSetting("mapBearing"),t=this.#t.getSetting("mapPitch"),a=this.#t.getSetting("mapProjection"),i=this.#t.getSetting("terrainEnabled"),s=this.#t.getLabelsState();(null!==e||null!==t)&&(this.#e.setBearing(e||0),this.#e.setPitch(t||0)),a&&"mercator"!==a&&setTimeout(()=>{this.#a.changeMapProjection(a)},500),i&&setTimeout(()=>{this.#a.enableTerrain()},800),s||setTimeout(()=>{this.#a.toggleMapLabels(!1)},1e3)}}#H(){this.#t&&this.#t.saveMapState(this.#e)}}document.addEventListener("DOMContentLoaded",function(){lucide.createIcons(),new r().init()})})();
//# sourceMappingURL=dashboard.js.map
