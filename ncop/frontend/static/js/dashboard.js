(()=>{var e,t=globalThis,o={},a={},i=t.parcelRequiref877;null==i&&((i=function(e){if(e in o)return o[e].exports;if(e in a){var t=a[e];delete a[e];var i={id:e,exports:{}};return o[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){a[e]=t},t.parcelRequiref877=i);var s=i.register;s("cCRTO",function(t,o){t.exports=i("dNLwc")(function(t){if(t=i.i?.[t]||t,!e)try{throw Error()}catch(a){var o=(""+a.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!o)return"./"+t;e=o[0]}return new URL("./"+t,e).toString()}("ewq3m")).then(()=>i("h3r7n"))}),s("dNLwc",function(e,t){"use strict";e.exports=i("7lV8K")(function(e){return new Promise(function(t,o){if([].concat(document.getElementsByTagName("script")).some(function(t){return t.src===e}))return void t();var a=document.createElement("link");a.href=e,a.rel="preload",a.as="script",document.head.appendChild(a);var i=document.createElement("script");i.async=!0,i.type="text/javascript",i.src=e,i.onerror=function(t){var a=TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));i.onerror=i.onload=null,i.remove(),o(a)},i.onload=function(){i.onerror=i.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(i)})})}),s("7lV8K",function(e,t){"use strict";var o={},a={},i={};e.exports=function(e,t){return function(s){var n=function(e){switch(e){case"preload":return a;case"prefetch":return i;default:return o}}(t);return n[s]?n[s]:n[s]=e.apply(null,arguments).catch(function(e){throw delete n[s],e})}}}),Object.assign(i.i??={},{ewq3m:"map-layers.fa6673b4.js"});var n=class{constructor(){this.storagePrefix="ncop_",this.currentUser=null,this.defaultSettings={mapStyle:"streets-v12",mapCenter:[74.3,31.5],mapZoom:6,mapBearing:0,mapPitch:0,labelsEnabled:!0,userPanelVisible:!1,basemapPanelVisible:!1,theme:"default",autoSaveInterval:3e4,notifications:!0,lastLogin:null,lastActivity:null,sessionData:{}},this.init()}init(){window.USER_ID&&(this.currentUser=window.USER_ID),this.initializeUserSettings(),this.setupAutoSave(),console.log("\uD83D\uDDC4️ NCOP Storage Manager initialized for user:",this.currentUser)}getUserKey(e){return this.currentUser?`${this.storagePrefix}user_${this.currentUser}_${e}`:`${this.storagePrefix}guest_${e}`}initializeUserSettings(){let e=this.getAllSettings();e&&0!==Object.keys(e).length||(this.saveAllSettings(this.defaultSettings),console.log("\uD83D\uDCDD Initialized default settings for user"))}saveSetting(e,t){try{let o=this.getUserKey(e);localStorage.setItem(o,JSON.stringify({value:t,timestamp:Date.now(),user:this.currentUser})),console.log(`\u{1F4BE} Saved ${e}:`,t)}catch(e){console.error("❌ Error saving to localStorage:",e)}}getSetting(e,t=null){try{let o=this.getUserKey(e),a=localStorage.getItem(o);if(a)return JSON.parse(a).value;return void 0!==this.defaultSettings[e]?this.defaultSettings[e]:t}catch(o){return console.error("❌ Error reading from localStorage:",o),void 0!==this.defaultSettings[e]?this.defaultSettings[e]:t}}saveAllSettings(e){Object.keys(e).forEach(t=>{this.saveSetting(t,e[t])})}getAllSettings(){let e={};return Object.keys(this.defaultSettings).forEach(t=>{e[t]=this.getSetting(t)}),e}saveMapState(e){let t=e.getCenter(),o=e.getZoom(),a=e.getBearing(),i=e.getPitch();this.saveSetting("mapCenter",[t.lng,t.lat]),this.saveSetting("mapZoom",o),this.saveSetting("mapBearing",a),this.saveSetting("mapPitch",i),console.log("\uD83D\uDDFA️ Map state saved")}restoreMapState(e){let t=this.getSetting("mapCenter"),o=this.getSetting("mapZoom"),a=this.getSetting("mapBearing"),i=this.getSetting("mapPitch");t&&null!==o&&(e.jumpTo({center:t,zoom:o,bearing:a,pitch:i}),console.log("\uD83D\uDDFA️ Map state restored"))}saveMapStyle(e){this.saveSetting("mapStyle",e)}getMapStyle(){return this.getSetting("mapStyle")}saveLabelsState(e){this.saveSetting("labelsEnabled",e)}getLabelsState(){return this.getSetting("labelsEnabled")}saveUserPanelState(e){this.saveSetting("userPanelVisible",e)}getUserPanelState(){return this.getSetting("userPanelVisible")}saveBasemapPanelState(e){this.saveSetting("basemapPanelVisible",e)}getBasemapPanelState(){return this.getSetting("basemapPanelVisible")}saveSessionData(e,t){let o=this.getSetting("sessionData",{});o[e]={value:t,timestamp:Date.now()},this.saveSetting("sessionData",o)}getSessionData(e){let t=this.getSetting("sessionData",{});return t[e]?t[e].value:null}updateLastActivity(){this.saveSetting("lastActivity",Date.now())}updateLastLogin(){this.saveSetting("lastLogin",Date.now())}getLastActivity(){return this.getSetting("lastActivity")}getLastLogin(){return this.getSetting("lastLogin")}setupAutoSave(){setInterval(()=>{this.updateLastActivity()},this.getSetting("autoSaveInterval",3e4)),window.addEventListener("beforeunload",()=>{this.updateLastActivity()})}clearUserData(){let e=Object.keys(localStorage),t=this.getUserKey("");e.forEach(e=>{e.startsWith(t.slice(0,-1))&&localStorage.removeItem(e)}),console.log("\uD83D\uDDD1️ User data cleared")}exportSettings(){let e=this.getAllSettings();return JSON.stringify({user:this.currentUser,timestamp:Date.now(),version:"1.0",settings:e},null,2)}importSettings(e){try{let t=JSON.parse(e);if(t.settings)return this.saveAllSettings(t.settings),console.log("\uD83D\uDCE5 Settings imported successfully"),!0}catch(e){console.error("❌ Error importing settings:",e)}return!1}getStorageInfo(){let e=Object.keys(localStorage).filter(e=>e.startsWith(this.getUserKey(""))),t=0;return e.forEach(e=>{t+=localStorage.getItem(e).length}),{totalKeys:e.length,totalSize:t,sizeKB:(t/1024).toFixed(2),maxSize:"5-10MB (browser dependent)",keys:e}}static isAvailable(){try{let e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}};class r{#e;#t;constructor(e,t){this.#e=e,this.#t=t}toggleMapLabels(e){let t=this.#e.getStyle();t&&t.layers&&t.layers.forEach(t=>{"symbol"===t.type&&t.layout&&t.layout["text-field"]&&this.#e.setLayoutProperty(t.id,"visibility",e?"visible":"none")}),console.log(`\u{1F5FA}\u{FE0F} Map labels toggled: ${e?"visible":"none"}`)}changeMapProjection(e){try{this.#e.setProjection(e),console.log(`\u{1F30D} Changed projection to: ${e}`),this.#t&&this.#t.saveSetting("mapProjection",e)}catch(e){console.error("Error changing projection:",e),this.#e.setProjection("mercator")}}enableTerrain(){console.log("\uD83C\uDFD4️ Enabling 3D Terrain mode...");let e="mapbox-dem";if(!this.#e.getSource(e))try{this.#e.addSource(e,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14})}catch(e){console.warn("Error adding terrain source:",e)}try{this.#e.setTerrain({source:e,exaggeration:1.5})}catch(e){console.warn("Error setting terrain:",e)}this.#e.easeTo({pitch:80,bearing:-17.6,duration:1e3}),this.#t&&this.#t.saveSetting("terrainEnabled",!0)}disableTerrain(){console.log("\uD83D\uDDFA️ Switching to 2D mode...");try{this.#e.setTerrain(null)}catch(e){console.warn("Error removing terrain:",e)}setTimeout(()=>{try{this.#e.getSource("mapbox-dem")&&this.#e.removeSource("mapbox-dem")}catch(e){console.warn("Error removing terrain source:",e)}},200);let e=this.#t&&this.#t.getSetting("mapProjection")||"mercator";this.#e.easeTo({pitch:0,bearing:0,duration:1e3}),setTimeout(()=>{try{this.#e.setProjection(e),console.log("\uD83C\uDF0D Projection restored to:",e)}catch(e){console.warn("Error setting projection:",e),this.#e.setProjection("mercator")}},1200),this.#t&&this.#t.saveSetting("terrainEnabled",!1)}}class l{#e;#o;constructor(e,t,o){this.#e=e,this.#o=t,this.projectionPanel=o,this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="nav-controls-wrapper",t.innerHTML=`
            <div class="custom-nav-control" id="navControlsContainer">
                <button id="zoomIn" class="custom-nav-btn" title="Zoom In"><i data-lucide="plus"></i></button>
                <button id="zoomOut" class="custom-nav-btn" title="Zoom Out"><i data-lucide="minus"></i></button>
                <button id="resetBearing" class="custom-nav-btn" title="Reset Bearing"><i data-lucide="compass"></i></button>
                <button id="toggle3D" class="custom-nav-btn" title="Switch to 3D View (2D Mode)">
                    <span class="nav-text">3D</span>
                </button>
                <button id="projectionSwitch" class="custom-nav-btn" title="Map Projections"><i data-lucide="earth"></i></button>
                <button id="locate" class="custom-nav-btn" title="Find My Location"><i data-lucide="map-pin"></i></button>
                <button id="homeExtent" class="custom-nav-btn" title="Zoom to Pakistan"><i data-lucide="house"></i></button>
                <button id="navToggleBtn" class="nav-toggle-btn" title="Toggle Navigation Controls"><i data-lucide="chevron-left"></i></button>
            </div>
        `,e.appendChild(t),lucide.createIcons(),this.restoreToggle3DState(window.ncop_storage?.getSetting("terrainEnabled"))}addEventListeners(){document.getElementById("navToggleBtn")?.addEventListener("click",this.#a.bind(this)),document.getElementById("zoomIn")?.addEventListener("click",()=>this.#e.zoomIn({duration:300})),document.getElementById("zoomOut")?.addEventListener("click",()=>this.#e.zoomOut({duration:300})),document.getElementById("resetBearing")?.addEventListener("click",this.#i.bind(this)),document.getElementById("toggle3D")?.addEventListener("click",this.#s.bind(this)),document.getElementById("projectionSwitch")?.addEventListener("click",()=>this.projectionPanel.togglePanel()),document.getElementById("locate")?.addEventListener("click",this.#n.bind(this)),document.getElementById("homeExtent")?.addEventListener("click",this.#r.bind(this))}#a(){let e=document.getElementById("navControlsContainer").classList.toggle("collapsed"),t=document.getElementById("navToggleBtn")?.querySelector("i");t&&(t.setAttribute("data-lucide",e?"chevron-right":"chevron-left"),lucide.createIcons())}#i(){this.#e.easeTo({bearing:0,pitch:0,duration:500})}#s(){document.getElementById("toggle3D");let e=!window.ncop_storage?.getSetting("terrainEnabled");e?this.#o.enableTerrain():this.#o.disableTerrain(),this.restoreToggle3DState(e)}#n(){let e=[73.09896723226383,33.681421388232];this.#e.flyTo({center:e,zoom:14,duration:2e3}),new mapboxgl.Marker({color:"#ff0000"}).setLngLat(e).addTo(this.#e),console.log("\uD83C\uDFAF Zoomed to target location:",e)}#r(){this.#e.flyTo({center:[69.3451,30.3753],zoom:5,duration:2e3,essential:!0}),console.log("\uD83C\uDFE0 Zoomed to Pakistan extent")}restoreToggle3DState(e){let t=document.getElementById("toggle3D");t&&(e?(t.title="Switch to 2D View (3D Mode)",t.classList.add("terrain-active")):(t.title="Switch to 3D View (2D Mode)",t.classList.remove("terrain-active")))}}class c{#e;#o;#l;#t=window.ncop_storage;constructor(e,t){this.#e=e,this.#o=t,this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=this.#t?this.#t.getSetting("mapProjection"):"mercator";this.#l=document.createElement("div"),this.#l.id="projectionPanel",this.#l.className="projection-panel",this.#l.innerHTML=`
            <div class="projection-header">
                <h3>Map Projections</h3>
                <button id="projectionClose" class="projection-close-btn"><i data-lucide="x"></i></button>
            </div>
            <div class="projection-list">
                ${[{key:"mercator",name:"Mercator",desc:"Standard web map projection",emoji:"\uD83C\uDF0D"},{key:"globe",name:"Globe",desc:"3D globe view",emoji:"\uD83C\uDF10"},{key:"albers",name:"Albers",desc:"Equal-area conic projection",emoji:"\uD83D\uDDFA️"},{key:"equalEarth",name:"Equal Earth",desc:"Equal-area pseudocylindrical",emoji:"\uD83C\uDF0E"},{key:"naturalEarth",name:"Natural Earth",desc:"Compromise pseudocylindrical",emoji:"\uD83C\uDF0F"},{key:"winkelTripel",name:"Winkel Tripel",desc:"Modified azimuthal projection",emoji:"\uD83D\uDDFA️"}].map(e=>`
                    <div class="projection-item ${e.key===t?"active":""}" data-projection="${e.key}">
                        <div class="projection-preview">${e.emoji}</div>
                        <div class="projection-info">
                            <div class="projection-name">${e.name}</div>
                            <div class="projection-desc">${e.desc}</div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `,e.appendChild(this.#l),lucide.createIcons()}addEventListeners(){document.getElementById("projectionClose")?.addEventListener("click",()=>{this.#l.classList.remove("visible")}),this.#l.querySelectorAll(".projection-item").forEach(e=>{e.addEventListener("click",this.#c.bind(this,e))}),document.addEventListener("click",this.#d.bind(this))}#c(e){let t=e.dataset.projection;this.#o.changeMapProjection(t),this.#l.querySelectorAll(".projection-item").forEach(e=>e.classList.remove("active")),e.classList.add("active"),setTimeout(()=>{this.#l.classList.remove("visible")},500)}updateActiveProjection(){let e=this.#t&&this.#t.getSetting("mapProjection")||"mercator";this.#l.querySelectorAll(".projection-item").forEach(t=>{t.classList.remove("active"),t.dataset.projection===e&&t.classList.add("active")})}togglePanel(){this.#l&&(this.#l.classList.contains("visible")||this.updateActiveProjection(),this.#l.classList.toggle("visible"))}#d(e){let t=document.getElementById("projectionSwitch");this.#l.contains(e.target)||t.contains(e.target)||this.#l.classList.remove("visible")}}class d{#e;#t=window.ncop_storage;#o;#g=[{id:"streets-v12",name:"Streets",emoji:"\uD83C\uDFD9️"},{id:"satellite-streets-v12",name:"Satellite",emoji:"\uD83D\uDEF0️"},{id:"outdoors-v12",name:"Outdoors",emoji:"\uD83C\uDFD4️"},{id:"light-v11",name:"Light",emoji:"☀️"},{id:"dark-v11",name:"Dark",emoji:"\uD83C\uDF19"},{id:"satellite-v9",name:"Satellite Only",emoji:"\uD83D\uDCE1"},{id:"navigation-day-v1",name:"Navigation Day",emoji:"\uD83D\uDDFA️"},{id:"navigation-night-v1",name:"Navigation Night",emoji:"\uD83C\uDF03"}];#u;#m;constructor(e,t){this.#e=e,this.#o=t,this.#u=this.#t?this.#t.getMapStyle():"streets-v12",this.#m=!this.#t||this.#t.getLabelsState(),this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="custom-basemap-control",t.innerHTML=`
            <button id="basemapToggle" class="custom-basemap-btn" title="Change Basemap">
                <i data-lucide="layers"></i>
            </button>
            <div id="basemapPanel" class="basemap-panel">
                <div class="labels-toggle">
                    <span class="labels-toggle-text">Show Labels</span>
                    <div class="toggle-switch ${this.#m?"active":""}" id="labelsToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="basemap-list" id="basemapList">
                    ${this.#g.map(e=>`
                        <div class="basemap-item ${e.id===this.#u?"active":""}" data-style="${e.id}">
                            <div class="basemap-image">${e.emoji}</div>
                            <span class="basemap-name">${e.name}</span>
                        </div>
                    `).join("")}
                </div>
            </div>
        `,e.appendChild(t),lucide.createIcons()}addEventListeners(){let e=document.getElementById("basemapToggle"),t=document.getElementById("basemapPanel"),o=document.getElementById("labelsToggle"),a=document.getElementById("basemapList");e?.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("visible")}),o?.addEventListener("click",this.#h.bind(this)),a?.addEventListener("click",this.#p.bind(this)),document.addEventListener("click",this.#d.bind(this));let i=document.getElementById("userPanel");i&&this.#b(i)}#h(){this.#m=!this.#m,document.getElementById("labelsToggle").classList.toggle("active",this.#m),this.#t&&this.#t.saveLabelsState(this.#m),this.#o.toggleMapLabels(this.#m)}#p(e){let t=e.target.closest(".basemap-item");if(t){let e=t.dataset.style,o=document.getElementById("basemapPanel");document.querySelectorAll(".basemap-item").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),this.#e.setStyle(`mapbox://styles/mapbox/${e}`),this.#u=e,this.#t&&this.#t.saveMapStyle(e),o.classList.remove("visible"),this.#e.once("styledata",()=>{this.#m||this.#o.toggleMapLabels(!1)})}}#d(e){let t=document.getElementById("basemapToggle"),o=document.getElementById("basemapPanel");o.contains(e.target)||t.contains(e.target)||o.classList.remove("visible")}#b(e){let t=document.querySelector(".custom-basemap-control"),o=document.getElementById("basemapPanel");new MutationObserver(a=>{a.forEach(a=>{"attributes"===a.type&&"class"===a.attributeName&&(e.classList.contains("user-panel-visible")?(t.classList.add("panel-open"),o.classList.remove("visible")):t.classList.remove("panel-open"))})}).observe(e,{attributes:!0})}}class g{#v;#y;#S;#t=window.ncop_storage;constructor(){console.log("\uD83D\uDE80 SidebarMenu constructor called"),this.renderButton(),console.log("✅ Button rendered"),this.#v=document.getElementById("sidebarPanel"),console.log("\uD83D\uDD0D Sidebar panel:",this.#v),this.#S=this.#v?.querySelector(".accordion-container"),console.log("\uD83D\uDD0D Accordion container:",this.#S),this.loadSidebarConfig(),console.log("✅ Config loading started"),this.addEventListeners(),console.log("✅ Event listeners added"),console.log("\uD83D\uDCCB Sidebar menu initialized")}renderButton(){let e=document.getElementById("map");this.#y=document.createElement("div"),this.#y.className="custom-menu-control",this.#y.innerHTML=`
            <button id="menuToggle" class="custom-menu-btn" title="Open Menu">
                <i data-lucide="menu"></i>
            </button>
        `,e.appendChild(this.#y),lucide.createIcons()}addEventListeners(){document.getElementById("menuToggle")?.addEventListener("click",this.openSidebar.bind(this)),document.getElementById("sidebarCloseBtn")?.addEventListener("click",this.closeSidebar.bind(this)),document.addEventListener("keydown",this.#f.bind(this))}openSidebar(){this.#v?.classList.add("visible"),this.#y?.classList.add("hidden")}closeSidebar(){this.#v?.classList.remove("visible"),this.#y?.classList.remove("hidden")}#f(e){"Escape"===e.key&&this.#v?.classList.contains("visible")&&this.closeSidebar()}async loadSidebarConfig(){try{console.log("\uD83D\uDD0D Starting to import map-layers.js...");let{ncop_menu_items:e}=await i("cCRTO");console.log("\uD83D\uDCCB Import successful! Menu configuration:",e),console.log("\uD83D\uDCCB Available categories:",Object.keys(e||{})),e&&Object.keys(e).length>0?(console.log("✅ Starting sidebar population..."),this.#E(e)):(console.warn("⚠️ ncop_menu_items is empty or undefined, using basic sidebar"),this.#D())}catch(e){console.error("❌ Error loading NCOP menu configuration:",e),console.error("❌ Error details:",e.message,e.stack),this.#D()}}#E(e){this.#S&&(this.#S.innerHTML="",Object.keys(e).forEach(t=>{let o=e[t],a=this.#C(t,o);this.#S.appendChild(a)}),lucide.createIcons(),this.#L(),this.#w(),setTimeout(()=>{this.#T()},100))}#j(e){return({gis_layers:{title:"GIS Layers",icon:"layers",customIcon:"/static/icons/accordion_icons/gis-layers.webp"},weather:{title:"Weather Systems",icon:"cloud",customIcon:"/static/icons/accordion_icons/weather-systems.webp"},flood:{title:"Flood Monitoring",icon:"waves",customIcon:"/static/icons/accordion_icons/flood.webp"},air_quality:{title:"Air Quality",icon:"wind",customIcon:"/static/icons/accordion_icons/air-quality.webp"},"ocean/coastal":{title:"Ocean & Coastal",icon:"anchor",customIcon:"/static/icons/accordion_icons/ocean-coastal.webp"},"Disaster Early Warning (DEW)":{title:"Early Warning",icon:"alert-triangle",customIcon:"/static/icons/accordion_icons/early-warning.webp"}})[e]||{title:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),icon:"folder"}}#C(e,t){let o=document.createElement("div");o.className="accordion-item";let a=this.#j(e),i=a.customIcon?`<img src="${a.customIcon}" alt="${a.title}" class="accordion-custom-icon">`:`<i data-lucide="${a.icon}" class="accordion-icon"></i>`,s=document.createElement("div");s.className="accordion-header",s.innerHTML=`${i}<span class="accordion-title">${a.title}</span><i data-lucide="chevron-down" class="accordion-chevron"></i>`;let n=document.createElement("div");return n.className="accordion-content",Object.keys(t).forEach(e=>{let o=t[e];n.appendChild(this.#x(e,o))}),o.appendChild(s),o.appendChild(n),o}#x(e,t){let o=document.createElement("div");o.className="ncop-subcategory";let a=document.createElement("div");a.className="ncop-subcategory-header",a.innerHTML=`<span>${e}</span><i data-lucide="chevron-right" class="subcategory-chevron"></i>`;let i=document.createElement("div");return i.className="ncop-items-container",console.log(`\u{1F50D} Rendering subcategory: ${e}`,t),Object.keys(t).forEach(e=>{let o=t[e];if(console.log(`\u{1F50D} Processing type: ${e}`,o),"toggle"===e)console.log(`\u{2705} Creating toggle items for ${e}:`,Object.keys(o)),Object.keys(o).forEach(e=>{console.log(`\u{1F50D} Creating toggle item: ${e}`,o[e]);let t=this.#I(e,o[e]);t?(console.log(`\u{2705} Created toggle element:`,t),i.appendChild(t)):console.error(`\u{274C} Failed to create toggle element for ${e}`)});else if("temporal"===e){console.log(`\u{2705} Creating temporal items for ${e}:`,Object.keys(o));let t=document.createElement("div");t.className="grid grid-cols-2 gap-2",Object.keys(o).forEach(e=>{console.log(`\u{1F50D} Creating temporal item: ${e}`,o[e]);let a=this.#k(e,o[e]);a?(console.log(`\u{2705} Created temporal element:`,a),t.appendChild(a)):console.error(`\u{274C} Failed to create temporal element for ${e}`)}),i.appendChild(t)}else if("dropdown"===e){console.log(`\u{2705} Creating dropdown item for ${e}:`,o);let t=this.#P(e,o);t?(console.log(`\u{2705} Created dropdown element:`,t),i.appendChild(t)):console.error(`\u{274C} Failed to create dropdown element for ${e}`)}else if("button"===e){console.log(`\u{2705} Creating button items for ${e}:`,Object.keys(o));let t=document.createElement("div");t.className="grid grid-cols-2 gap-1",Object.keys(o).forEach(e=>{console.log(`\u{1F50D} Creating button item: ${e}`,o[e]);let a=this.#$(e,o[e]);a?(console.log(`\u{2705} Created button element:`,a),t.appendChild(a)):console.error(`\u{274C} Failed to create button element for ${e}`)}),i.appendChild(t)}else console.warn(`\u{26A0}\u{FE0F} Unknown item type: ${e}`,o)}),a.addEventListener("click",function(){let e=this.classList.contains("expanded"),t=this.closest(".accordion-content"),o=t?.querySelectorAll(".ncop-subcategory-header");o?.forEach(e=>{e!==this&&(e.classList.remove("expanded"),e.nextElementSibling?.classList.remove("visible"))}),e?(this.classList.remove("expanded"),i.classList.remove("visible")):(this.classList.add("expanded"),i.classList.add("visible"))}),o.appendChild(a),o.appendChild(i),o}#I(e,t){if(console.log(`\u{1F527} Creating toggle item: ${e}`,t),!t||!t.label)return console.error(`\u{274C} Invalid toggle item data for ${e}:`,t),null;let o=document.createElement("div");return o.className="ncop-item flex justify-between items-center p-2",o.innerHTML=`
            <span class="ncop-item-label">${t.label}</span>
            <label class="ncop-toggle">
                <input type="checkbox" data-item-key="${e}">
                <span class="ncop-toggle-slider"></span>
            </label>
        `,console.log(`\u{2705} Toggle item created successfully:`,o),o}#k(e,t){if(console.log(`\u{1F527} Creating temporal item: ${e}`,t),!t||!t.label)return console.error(`\u{274C} Invalid temporal item data for ${e}:`,t),null;let o=document.createElement("div");return o.className="ncop-item flex flex-col items-center justify-center p-2 text-center",o.innerHTML=`
            <div class="ncop-item-image w-full h-20 mb-2">
                <img src="${t.image||"/static/images/placeholder.png"}" alt="${t.label}" class="w-full h-full object-cover rounded-md" />
            </div>
            <span class="ncop-item-label text-xs text-gray-300">${t.label}</span>
        `,console.log(`\u{2705} Temporal item created successfully:`,o),o}#P(e,t){if(console.log(`\u{1F527} Creating dropdown item: ${e}`,t),!t)return console.error(`\u{274C} Invalid dropdown item data for ${e}:`,t),null;let o=document.createElement("div");o.className="ncop-item p-2";let a=t.endpoint||"",i=t.key||"id",s=t.attribute||"label";return console.log(`\u{1F50D} Dropdown config - endpoint: ${a}, key: ${i}, attribute: ${s}`),o.innerHTML=`
            <select class="ncop-dropdown w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg p-2.5" data-endpoint="${a}" data-key-field="${i}" data-attribute-field="${s}" data-item-key="${e}">
                <option selected>Loading...</option>
            </select>
        `,setTimeout(()=>{let t=o.querySelector("select");if(!a){console.warn(`\u{26A0}\u{FE0F} No endpoint provided for dropdown ${e}`),t.innerHTML="<option selected disabled>No endpoint</option>";return}console.log(`\u{1F4E1} Fetching dropdown data from: ${a}`),fetch(a).then(e=>e.json()).then(o=>{console.log(`\u{1F4CA} Dropdown data for ${e}:`,o),t.innerHTML="<option selected disabled>Select an option</option>",o.forEach(e=>{console.log(`\u{1F50D} Processing row:`,e);let o=e[i],a=e[s];console.log(`\u{2705} Value: ${o}, Label: ${a}`),t.innerHTML+=`<option value="${o}">${a}</option>`})}).catch(o=>{console.error(`\u{274C} Dropdown fetch error for ${e}:`,o),t.innerHTML="<option selected disabled>Error loading data</option>"})},0),console.log(`\u{2705} Dropdown item created successfully:`,o),o}#$(e,t){if(console.log(`\u{1F527} Creating button item: ${e}`,t),!t||!t.label)return console.error(`\u{274C} Invalid button item data for ${e}:`,t),null;let o=document.createElement("div");return o.className="ncop-item w-full text-white font-bold py-2 px-4 rounded-md border-2 cursor-pointer",o.style.backgroundColor=t.color||"#6366f1",o.style.borderColor=t.outline||"#4f46e5",o.innerHTML=`${t.label}`,console.log(`\u{2705} Button item created successfully:`,o),o}#L(){document.querySelectorAll(".accordion-header").forEach(e=>{e.addEventListener("click",function(){let e=this.nextElementSibling,t=this.classList.contains("active");document.querySelectorAll(".accordion-header").forEach(e=>{e!==this&&(e.classList.remove("active"),e.nextElementSibling?.classList.remove("expanded"))}),this.classList.toggle("active",!t),e?.classList.toggle("expanded",!t)})})}#D(){this.#S&&(this.#S.innerHTML=`
            <div class="accordion-item">
                <div class="accordion-header">
                    <i data-lucide="settings"></i>
                    <span>System Menu</span>
                    <i data-lucide="chevron-down" class="accordion-chevron"></i>
                </div>
                <div class="accordion-content">
                    <ul class="accordion-items">
                        <li class="accordion-item-entry" data-action="exportData">
                            <i data-lucide="download"></i><span>Export Settings</span>
                        </li>
                        <li class="accordion-item-entry" data-action="showHelp">
                            <i data-lucide="help-circle"></i><span>Help & Support</span>
                        </li>
                    </ul>
                </div>
            </div>
        `,this.#L(),lucide.createIcons())}#B(e,t,o){console.log(`\u{1F504} NCOP Toggle - ${t}:`,{endpoint:e,enabled:o}),this.#t&&this.#t.saveSetting(`ncop_toggle_${t}`,o);let a=o?"enabled":"disabled";console.log(`\u{1F4E1} ${t} has been ${a}`)}#M(e,t,o){if(console.log(`\u{1F4CB} NCOP Dropdown - ${t}:`,{endpoint:e,value:o}),this.#t&&this.#t.saveSetting(`ncop_dropdown_${t}`,o),""===o)return void console.log(`\u{1F4CB} ${t} selection cleared`);console.log(`\u{1F4CA} ${t} set to: ${o}`)}#T(){this.#t&&(document.querySelectorAll('.ncop-toggle input[type="checkbox"]').forEach(e=>{let t=e.dataset.itemKey,o=this.#t.getSetting(`ncop_toggle_${t}`);null!==o&&(e.checked=o)}),document.querySelectorAll(".ncop-dropdown").forEach(e=>{let t=e.dataset.itemKey,o=this.#t.getSetting(`ncop_dropdown_${t}`);null!==o&&(e.value=o)}),console.log("\uD83D\uDD04 NCOP control states restored from localStorage"))}#w(){let e=document.getElementById("sidebarSearch"),t=document.getElementById("clearSearch");e&&t&&(e.addEventListener("input",e=>{let o=e.target.value.toLowerCase().trim();o?(t.style.display="flex",this.#A(o)):(t.style.display="none",this.#N())}),t.addEventListener("click",()=>{e.value="",t.style.display="none",this.#N()}))}#A(e){let t=this.#S;if(!t)return;let o=0;t.querySelectorAll(".accordion-item").forEach(t=>{let a=!1,i=t.querySelector(".accordion-header"),s=t.querySelector(".accordion-content"),n=i.querySelector("span"),r=n?.textContent.toLowerCase()||"",l=r.includes(e);l&&(a=!0);let c=t.querySelectorAll(".ncop-subcategory"),d=0;c.forEach(t=>{let o=!1,i=t.querySelector(".ncop-subcategory-header"),s=i?.querySelector("span"),n=s?s.textContent.toLowerCase():"",l=t.querySelector(".ncop-items-container");n.includes(e)&&(o=!0,a=!0);let c=t.querySelectorAll(".ncop-item"),g=0;c.forEach(t=>{let i=t.querySelector(".ncop-item-label"),s=i?i.textContent.toLowerCase():"",l=t.querySelector('input[type="checkbox"]'),c=t.querySelector("select");[s,l&&l.dataset.endpoint||"",c&&c.dataset.endpoint||"",n,r].join(" ").toLowerCase().includes(e)?(t.style.display="flex",g++,o=!0,a=!0,this.#F(i,e)):(t.style.display="none",this.#O(i))}),o?(t.style.display="block",d++,n.includes(e)?this.#F(s,e):this.#O(s),l&&i&&g>0&&(l.classList.add("visible"),i.classList.add("expanded"))):(t.style.display="none",this.#O(s))}),a?(t.style.display="block",o++,s&&d>0&&(s.classList.add("expanded"),i.classList.add("active")),l&&n?this.#F(n,e):n&&this.#O(n)):(t.style.display="none",n&&this.#O(n))}),0===o?this.#_():this.#q()}#N(){let e=this.#S;e&&(e.querySelectorAll(".accordion-item").forEach(e=>{e.style.display="block";let t=e.querySelector(".accordion-header"),o=e.querySelector(".accordion-content"),a=t.querySelector("span");this.#O(a),t.classList.remove("active"),o.classList.remove("expanded"),e.querySelectorAll(".ncop-subcategory").forEach(e=>{e.style.display="block";let t=e.querySelector(".ncop-subcategory-header"),o=t?.querySelector("span"),a=e.querySelector(".ncop-items-container");this.#O(o),t?.classList.remove("expanded"),a?.classList.remove("visible"),e.querySelectorAll(".ncop-item").forEach(e=>{e.style.display="flex";let t=e.querySelector(".ncop-item-label");this.#O(t)})})}),this.#q())}#F(e,t){if(!e||!t)return;this.#O(e);let o=e.textContent,a=RegExp(`(${t})`,"gi");e.innerHTML=o.replace(a,'<span class="search-highlight">$1</span>')}#O(e){if(e&&(e.querySelectorAll(".search-highlight").forEach(e=>{let t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}),e.classList.contains("search-highlight"))){let t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}}#_(){if(this.#q(),this.#S){let e=document.createElement("div");e.className="no-results-message",e.innerHTML="<p>No results found</p><small>Try different keywords or check spelling</small>",this.#S.appendChild(e),lucide.createIcons()}}#q(){document.querySelector(".no-results-message")?.remove()}}class u{#t=window.ncop_storage;constructor(){this.#H(),this.#U(),this.#z()}#H(){window.ncop_utils={exportSettings:this.exportSettings.bind(this),importSettings:this.importSettings.bind(this),clearAllData:this.clearAllData.bind(this),showStorageInfo:this.showStorageInfo.bind(this),resetToDefaults:this.resetToDefaults.bind(this)}}#U(){document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.shiftKey)switch(e.key){case"E":e.preventDefault(),this.exportSettings();break;case"I":e.preventDefault(),this.importSettings();break;case"D":e.preventDefault(),this.showStorageInfo()}})}#z(){console.log("\uD83D\uDD27 NCOP Utilities loaded. Available commands: (ncop_utils.[command])")}exportSettings(){if(this.#t){let e=new Blob([this.#t.exportSettings()],{type:"application/json"}),t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download=`ncop-settings-${new Date().toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(t),console.log("\uD83D\uDCE5 Settings exported")}}importSettings(){let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{let t=e.target.result;this.#t&&this.#t.importSettings(t)?alert("Settings imported successfully! Please refresh the page."):alert("Failed to import settings. Please check the file format.")},e.readAsText(t)}},e.click()}clearAllData(){confirm("Are you sure you want to clear all saved data? This cannot be undone.")&&this.#t&&(this.#t.clearUserData(),alert("All data cleared! Please refresh the page."))}showStorageInfo(){if(this.#t){let e=this.#t.getStorageInfo();console.table(e),alert(`
Storage Information:
- Total Keys: ${e.totalKeys}
- Total Size: ${e.sizeKB} KB
- Max Size: ${e.maxSize}
- User: ${window.USERNAME||"Guest"}
            `)}}resetToDefaults(){confirm("Reset all settings to defaults? This will clear your preferences.")&&this.#t&&(this.#t.clearUserData(),this.#t.initializeUserSettings(),alert("Settings reset to defaults! Please refresh the page."))}}class m{constructor(){this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="custom-user-control",t.innerHTML=`
            <button id="userToggle" class="custom-user-btn" title="User Info">
                <i data-lucide="user"></i>
            </button>
        `,e.appendChild(t),lucide.createIcons()}addEventListeners(){let e=document.getElementById("userToggle"),t=document.getElementById("userPanel");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("user-panel-visible")}),document.addEventListener("click",function(o){t.contains(o.target)||e.contains(o.target)||t.classList.remove("user-panel-visible")}))}}window.ncop_storage=null,n.isAvailable()?window.ncop_storage=new n:console.warn("⚠️ LocalStorage not available - user preferences will not be saved");class h{#e;#t=window.ncop_storage;#o;init(){if(!window.MAPBOX_ACCESS_TOKEN)return void console.error("Mapbox access token not found. Please check your environment configuration.");mapboxgl.accessToken=window.MAPBOX_ACCESS_TOKEN,this.#R(),this.#e.on("load",this.#K.bind(this)),this.#e.on("moveend",this.#V.bind(this)),this.#e.on("error",e=>console.error("Map error:",e)),this.#o=new r(this.#e,this.#t);let e=new c(this.#e,this.#o);new l(this.#e,this.#o,e),new m,new d(this.#e,this.#o),new g,new u,this.#t&&this.#t.updateLastLogin(),console.log("Dashboard initialized using a modular, class-based structure.")}#R(){let e=this.#t?this.#t.getMapStyle():"streets-v12",t=this.#t?this.#t.getSetting("mapCenter"):[74.3,31.5],o=this.#t?this.#t.getSetting("mapZoom"):6,a=this.#t?this.#t.getSetting("mapProjection"):"mercator";this.#e=new mapboxgl.Map({container:"map",style:`mapbox://styles/mapbox/${e}`,center:t,zoom:o,projection:a||"mercator",hash:!0})}#K(){if(console.log("Map loaded successfully"),this.#t){let e=this.#t.getSetting("mapBearing"),t=this.#t.getSetting("mapPitch"),o=this.#t.getSetting("mapProjection"),a=this.#t.getSetting("terrainEnabled"),i=this.#t.getLabelsState();(null!==e||null!==t)&&(this.#e.setBearing(e||0),this.#e.setPitch(t||0)),o&&"mercator"!==o&&setTimeout(()=>{this.#o.changeMapProjection(o)},500),a&&setTimeout(()=>{this.#o.enableTerrain()},800),i||setTimeout(()=>{this.#o.toggleMapLabels(!1)},1e3)}}#V(){this.#t&&this.#t.saveMapState(this.#e)}}document.addEventListener("DOMContentLoaded",function(){lucide.createIcons(),new h().init()})})();
//# sourceMappingURL=dashboard.js.map
