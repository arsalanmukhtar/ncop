(()=>{var e=globalThis,t={},a={},o=e.parcelRequiref877;null==o&&((o=function(e){if(e in t)return t[e].exports;if(e in a){var o=a[e];delete a[e];var i={id:e,exports:{}};return t[e]=i,o.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){a[e]=t},e.parcelRequiref877=o),(0,o.register)("h3r7n",function(e,t){Object.defineProperty(e.exports,"ncop_menu_items",{get:()=>a,set:void 0,enumerable:!0,configurable:!0});let a={gis_layers:{"Administrative Boundaries":{toggle:{national_boundary:{label:"National Boundary"},provincial_boundaries:{label:"Provincial Boundaries"},district_boundaries:{label:"District Boundaries"},tehsil_boundaries:{label:"Tehsil Boundaries"}}},Infrastructure:{toggle:{airports:{label:"Airports"},hospitals:{label:"Hospitals"},schools:{label:"Schools"},settlements:{label:"Settlements"},evacuation_points:{label:"Evacuation Points"}}},"Hydrological Layers":{toggle:{rsc_exceptionally_high_zone:{label:"RSC Exceptionally High Zone"},rsc_very_high_zone:{label:"RSC Very High Zone"},rsc_high_zone:{label:"RSC High Zone"},rsc_medium_zone:{label:"RSC Medium Zone"},rsc_low_zone:{label:"RSC Low Zone"},watershed_boundaries:{label:"Watershed Boundaries"}}}},weather:{"Radar Layers":{temporal:{realtime_radar:{label:"Realtime Radar",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},satellite_infrared:{label:"Satellite Infrared",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},dwd_satellite_infrared:{label:"DWD Satellite Infrared",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},imerg_precipitation_rate_14_days:{label:"IMERG Precipitation Rate (14 Days)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}}},"Global Deterministic Prediction System (GDPS)":{temporal:{specific_humidity_2m_above_ground:{label:"Specific Humidity (2m Above Ground)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},relative_humidity_percent:{label:"Relative Humidity (%)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},accumulated_precipitation:{label:"Accumulated Precipitation",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},"precipitation_type_/_3hrs":{label:"Precipitation Type / 3hrs",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}}},"ECMWF Weather Forecast Parameters":{temporal:{temperature_850hPa:{label:"Temperature (850hPa)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},lightning_forecast:{label:"Lightning Forecast",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},tropical_cyclone_strike_probability:{label:"Tropical Cyclone Strike Probability",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}}},"Meteoblue Forecast":{temporal:{weekly_precipitation_2m_above_ground:{label:"Weekly Precipitation (2m Above Ground)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},hourly_precipitation_2m_above_ground:{label:"Hourly Precipitation (2m Above Ground)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},hourly_snowfall_forecast:{label:"Hourly Snowfall (Forecast)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},weekly_snowfall_forecast:{label:"Weekly Snow (Forecast)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},cape_hourly_forecast:{label:"CAPE Hourly (Forecast)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},cape_weekly_forecast:{label:"CAPE Weekly (Forecast)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},"storm_helicity_forecast_0-3km":{label:"Storm Helicity Forecast (0-3km)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},precipitation_radar:{label:"Precipitation Radar",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},temperature_2m_above_ground:{label:"Temperature (2m Above Ground)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},official_weather_warnings_forecast:{label:"Official Weather Warnings (Forecast)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},meteorological_risks_forecast:{label:"Meteorological Risks (Forecast)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}}},"Pakistan Meteorological Department (PMD)":{toggle:{precipitation_past_3_days:{label:"Precipitation (Past 3 Days)"},pmd_rainfall_stations:{label:"PMD Rainfall Stations"},pmd_temperature_stations:{label:"PMD Temperature Stations"}}},"Indian Meteorological Department (IMD)":{toggle:{precipitation_past_3_days:{label:"Precipitation (Past 3 Days)"}}}},flood:{"Global Flood Awareness System (GloFAS)":{temporal:{precipitation_probability_50mm_10days:{label:"Precipitation Probability > 50mm (10 Days)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},precipitation_probability_150mm_10days:{label:"Precipitation Probability > 150mm (10 Days)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},precipitation_probability_300mm_10days:{label:"Precipitation Probability > 300mm (10 Days)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},accumulated_precipitation:{label:"Accumulated Precipitation",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},flood_summary_day_1_3:{label:"Flood Summary (Day 1-3)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},flood_summary_day_4_10:{label:"Flood Summary (Day 4-10)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}},toggle:{initial_temperature_at_2m:{label:"Initial Temperature at 2m"},major_rivers:{label:"Major Rivers"},major_river_basins:{label:"Major River Basins"},lakes_and_reservoirs:{label:"Lakes and Reservoirs"},soil_moisture_at_2m:{label:"Soil Moisture at 2m"},soil_moisture_anomaly_at_2m:{label:"Soil Moisture Anomaly at 2m"}}}},air_quality:{"Real Time Air Quality Parameters":{temporal:{"particulate_matter_2.5":{label:"Particulate Matter (2.5)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},particulate_matter_10:{label:"Particulate Matter (10)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},nitrogen_dioxide_850hPa:{label:"Nitrogen Dioxide (850hPa)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},ozone:{label:"Ozone",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},sulphur_dioxide_850hPa:{label:"Sulphur Dioxide (850hPa)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},carbon_monoxide:{label:"Carbon Monoxide",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},dust:{label:"Dust",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},methane_at_300hPa:{label:"Methane at 300hPa",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}}}},"ocean/coastal":{Oceanography:{temporal:{ocean_surface_salinity_10m:{label:"Ocean Surface Salinity (10m)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},ocean_surface_temperature_10m:{label:"Ocean Surface Temperature (10m)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},ocean_surface_currents_10m:{label:"Ocean Surface Currents (10m)",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"},ocean_surface_height_wrt_geoid:{label:"Ocean Surface Height w.r.t Geoid",image:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80"}}}},"Disaster Early Warning (DEW)":{"DEW Polygons":{toggle:{rajanpur_and_dg_khan:{label:"Rajanpur and DG Khan"},hyderabad_flash_flood:{label:"Hyderabad Flash Flood"},jhal_magsi_flash_flood:{label:"Jhal Magsi Flash Flood"},kalam_and_swat_flash_flood:{label:"Kalam & Swat Flash Flood"},muzaffarabad_flash_flood:{label:"Muzaffarabad Flash Flood"}}},"DEW Exposures Api Features":{dropdown:{endpoint:"http://172.18.1.108:8000/get-exposures/",key:"id",attribute:"remarks"}},"DEW Parameters":{button:{tech_ew:{label:"Tech EW",color:"#FF5733",outline:"#C70039"},nidm:{label:"NIDM",color:"#3366FF",outline:"#0033CC"},mobile_app:{label:"Mobile App",color:"#00CC99",outline:"#008066"},media_comm:{label:"Media Comm",color:"#FFC300",outline:"#CC9900"},drr:{label:"DRR",color:"#339933",outline:"#1E661E"},infra_development:{label:"Infra Development",color:"#607D8B",outline:"#455A64"},operations:{label:"Operations",color:"#CC0066",outline:"#99004C"},plans:{label:"Plans",color:"#663399",outline:"#4C2673"},intl_colaboration:{label:"Intl Collaboration",color:"#33CCFF",outline:"#0099CC"},rm_and_m:{label:"RM & M",color:"#996633",outline:"#664422"},cdrf:{label:"CDRF",color:"#00BFA5",outline:"#00897B"}}}}}});var i=class{constructor(){this.storagePrefix="ncop_",this.currentUser=null,this.defaultSettings={mapStyle:"streets-v12",mapCenter:[74.3,31.5],mapZoom:6,mapBearing:0,mapPitch:0,labelsEnabled:!0,userPanelVisible:!1,basemapPanelVisible:!1,theme:"default",autoSaveInterval:3e4,notifications:!0,lastLogin:null,lastActivity:null,sessionData:{}},this.init()}init(){window.USER_ID&&(this.currentUser=window.USER_ID),this.initializeUserSettings(),this.setupAutoSave(),console.log("\uD83D\uDDC4️ NCOP Storage Manager initialized for user:",this.currentUser)}getUserKey(e){return this.currentUser?`${this.storagePrefix}user_${this.currentUser}_${e}`:`${this.storagePrefix}guest_${e}`}initializeUserSettings(){let e=this.getAllSettings();e&&0!==Object.keys(e).length||(this.saveAllSettings(this.defaultSettings),console.log("\uD83D\uDCDD Initialized default settings for user"))}saveSetting(e,t){try{let a=this.getUserKey(e);localStorage.setItem(a,JSON.stringify({value:t,timestamp:Date.now(),user:this.currentUser})),console.log(`\u{1F4BE} Saved ${e}:`,t)}catch(e){console.error("❌ Error saving to localStorage:",e)}}getSetting(e,t=null){try{let a=this.getUserKey(e),o=localStorage.getItem(a);if(o)return JSON.parse(o).value;return void 0!==this.defaultSettings[e]?this.defaultSettings[e]:t}catch(a){return console.error("❌ Error reading from localStorage:",a),void 0!==this.defaultSettings[e]?this.defaultSettings[e]:t}}saveAllSettings(e){Object.keys(e).forEach(t=>{this.saveSetting(t,e[t])})}getAllSettings(){let e={};return Object.keys(this.defaultSettings).forEach(t=>{e[t]=this.getSetting(t)}),e}saveMapState(e){let t=e.getCenter(),a=e.getZoom(),o=e.getBearing(),i=e.getPitch();this.saveSetting("mapCenter",[t.lng,t.lat]),this.saveSetting("mapZoom",a),this.saveSetting("mapBearing",o),this.saveSetting("mapPitch",i),console.log("\uD83D\uDDFA️ Map state saved")}restoreMapState(e){let t=this.getSetting("mapCenter"),a=this.getSetting("mapZoom"),o=this.getSetting("mapBearing"),i=this.getSetting("mapPitch");t&&null!==a&&(e.jumpTo({center:t,zoom:a,bearing:o,pitch:i}),console.log("\uD83D\uDDFA️ Map state restored"))}saveMapStyle(e){this.saveSetting("mapStyle",e)}getMapStyle(){return this.getSetting("mapStyle")}saveLabelsState(e){this.saveSetting("labelsEnabled",e)}getLabelsState(){return this.getSetting("labelsEnabled")}saveUserPanelState(e){this.saveSetting("userPanelVisible",e)}getUserPanelState(){return this.getSetting("userPanelVisible")}saveBasemapPanelState(e){this.saveSetting("basemapPanelVisible",e)}getBasemapPanelState(){return this.getSetting("basemapPanelVisible")}saveSessionData(e,t){let a=this.getSetting("sessionData",{});a[e]={value:t,timestamp:Date.now()},this.saveSetting("sessionData",a)}getSessionData(e){let t=this.getSetting("sessionData",{});return t[e]?t[e].value:null}updateLastActivity(){this.saveSetting("lastActivity",Date.now())}updateLastLogin(){this.saveSetting("lastLogin",Date.now())}getLastActivity(){return this.getSetting("lastActivity")}getLastLogin(){return this.getSetting("lastLogin")}setupAutoSave(){setInterval(()=>{this.updateLastActivity()},this.getSetting("autoSaveInterval",3e4)),window.addEventListener("beforeunload",()=>{this.updateLastActivity()})}clearUserData(){let e=Object.keys(localStorage),t=this.getUserKey("");e.forEach(e=>{e.startsWith(t.slice(0,-1))&&localStorage.removeItem(e)}),console.log("\uD83D\uDDD1️ User data cleared")}exportSettings(){let e=this.getAllSettings();return JSON.stringify({user:this.currentUser,timestamp:Date.now(),version:"1.0",settings:e},null,2)}importSettings(e){try{let t=JSON.parse(e);if(t.settings)return this.saveAllSettings(t.settings),console.log("\uD83D\uDCE5 Settings imported successfully"),!0}catch(e){console.error("❌ Error importing settings:",e)}return!1}getStorageInfo(){let e=Object.keys(localStorage).filter(e=>e.startsWith(this.getUserKey(""))),t=0;return e.forEach(e=>{t+=localStorage.getItem(e).length}),{totalKeys:e.length,totalSize:t,sizeKB:(t/1024).toFixed(2),maxSize:"5-10MB (browser dependent)",keys:e}}static isAvailable(){try{let e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}};class s{#e;#t;constructor(e,t){this.#e=e,this.#t=t}toggleMapLabels(e){let t=this.#e.getStyle();t&&t.layers&&t.layers.forEach(t=>{"symbol"===t.type&&t.layout&&t.layout["text-field"]&&this.#e.setLayoutProperty(t.id,"visibility",e?"visible":"none")}),console.log(`\u{1F5FA}\u{FE0F} Map labels toggled: ${e?"visible":"none"}`)}changeMapProjection(e){try{this.#e.setProjection(e),console.log(`\u{1F30D} Changed projection to: ${e}`),this.#t&&this.#t.saveSetting("mapProjection",e)}catch(e){console.error("Error changing projection:",e),this.#e.setProjection("mercator")}}enableTerrain(){console.log("\uD83C\uDFD4️ Enabling 3D Terrain mode...");let e="mapbox-dem";if(!this.#e.getSource(e))try{this.#e.addSource(e,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14})}catch(e){console.warn("Error adding terrain source:",e)}try{this.#e.setTerrain({source:e,exaggeration:1.5})}catch(e){console.warn("Error setting terrain:",e)}this.#e.easeTo({pitch:80,bearing:-17.6,duration:1e3}),this.#t&&this.#t.saveSetting("terrainEnabled",!0)}disableTerrain(){console.log("\uD83D\uDDFA️ Switching to 2D mode...");try{this.#e.setTerrain(null)}catch(e){console.warn("Error removing terrain:",e)}setTimeout(()=>{try{this.#e.getSource("mapbox-dem")&&this.#e.removeSource("mapbox-dem")}catch(e){console.warn("Error removing terrain source:",e)}},200);let e=this.#t&&this.#t.getSetting("mapProjection")||"mercator";this.#e.easeTo({pitch:0,bearing:0,duration:1e3}),setTimeout(()=>{try{this.#e.setProjection(e),console.log("\uD83C\uDF0D Projection restored to:",e)}catch(e){console.warn("Error setting projection:",e),this.#e.setProjection("mercator")}},1200),this.#t&&this.#t.saveSetting("terrainEnabled",!1)}}class l{#e;#a;constructor(e,t,a){this.#e=e,this.#a=t,this.projectionPanel=a,this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="nav-controls-wrapper",t.innerHTML=`
            <div class="custom-nav-control" id="navControlsContainer">
                <button id="zoomIn" class="custom-nav-btn" title="Zoom In"><i data-lucide="plus"></i></button>
                <button id="zoomOut" class="custom-nav-btn" title="Zoom Out"><i data-lucide="minus"></i></button>
                <button id="resetBearing" class="custom-nav-btn" title="Reset Bearing"><i data-lucide="compass"></i></button>
                <button id="toggle3D" class="custom-nav-btn" title="Switch to 3D View (2D Mode)">
                    <span class="nav-text">3D</span>
                </button>
                <button id="projectionSwitch" class="custom-nav-btn" title="Map Projections"><i data-lucide="earth"></i></button>
                <button id="locate" class="custom-nav-btn" title="Find My Location"><i data-lucide="map-pin"></i></button>
                <button id="homeExtent" class="custom-nav-btn" title="Zoom to Pakistan"><i data-lucide="house"></i></button>
                <button id="navToggleBtn" class="nav-toggle-btn" title="Toggle Navigation Controls"><i data-lucide="chevron-left"></i></button>
            </div>
        `,e.appendChild(t),lucide.createIcons(),this.restoreToggle3DState(window.ncop_storage?.getSetting("terrainEnabled"))}addEventListeners(){document.getElementById("navToggleBtn")?.addEventListener("click",this.#o.bind(this)),document.getElementById("zoomIn")?.addEventListener("click",()=>this.#e.zoomIn({duration:300})),document.getElementById("zoomOut")?.addEventListener("click",()=>this.#e.zoomOut({duration:300})),document.getElementById("resetBearing")?.addEventListener("click",this.#i.bind(this)),document.getElementById("toggle3D")?.addEventListener("click",this.#s.bind(this)),document.getElementById("projectionSwitch")?.addEventListener("click",()=>this.projectionPanel.togglePanel()),document.getElementById("locate")?.addEventListener("click",this.#l.bind(this)),document.getElementById("homeExtent")?.addEventListener("click",this.#n.bind(this))}#o(){let e=document.getElementById("navControlsContainer").classList.toggle("collapsed"),t=document.getElementById("navToggleBtn")?.querySelector("i");t&&(t.setAttribute("data-lucide",e?"chevron-right":"chevron-left"),lucide.createIcons())}#i(){this.#e.easeTo({bearing:0,pitch:0,duration:500})}#s(){document.getElementById("toggle3D");let e=!window.ncop_storage?.getSetting("terrainEnabled");e?this.#a.enableTerrain():this.#a.disableTerrain(),this.restoreToggle3DState(e)}#l(){let e=[73.09896723226383,33.681421388232];this.#e.flyTo({center:e,zoom:14,duration:2e3}),new mapboxgl.Marker({color:"#ff0000"}).setLngLat(e).addTo(this.#e),console.log("\uD83C\uDFAF Zoomed to target location:",e)}#n(){this.#e.flyTo({center:[69.3451,30.3753],zoom:5,duration:2e3,essential:!0}),console.log("\uD83C\uDFE0 Zoomed to Pakistan extent")}restoreToggle3DState(e){let t=document.getElementById("toggle3D");t&&(e?(t.title="Switch to 2D View (3D Mode)",t.classList.add("terrain-active")):(t.title="Switch to 3D View (2D Mode)",t.classList.remove("terrain-active")))}}class n{#e;#a;#r;#t=window.ncop_storage;constructor(e,t){this.#e=e,this.#a=t,this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=this.#t?this.#t.getSetting("mapProjection"):"mercator";this.#r=document.createElement("div"),this.#r.id="projectionPanel",this.#r.className="projection-panel",this.#r.innerHTML=`
            <div class="projection-header">
                <h3>Map Projections</h3>
                <button id="projectionClose" class="projection-close-btn"><i data-lucide="x"></i></button>
            </div>
            <div class="projection-list">
                ${[{key:"mercator",name:"Mercator",desc:"Standard web map projection",emoji:"\uD83C\uDF0D"},{key:"globe",name:"Globe",desc:"3D globe view",emoji:"\uD83C\uDF10"},{key:"albers",name:"Albers",desc:"Equal-area conic projection",emoji:"\uD83D\uDDFA️"},{key:"equalEarth",name:"Equal Earth",desc:"Equal-area pseudocylindrical",emoji:"\uD83C\uDF0E"},{key:"naturalEarth",name:"Natural Earth",desc:"Compromise pseudocylindrical",emoji:"\uD83C\uDF0F"},{key:"winkelTripel",name:"Winkel Tripel",desc:"Modified azimuthal projection",emoji:"\uD83D\uDDFA️"}].map(e=>`
                    <div class="projection-item ${e.key===t?"active":""}" data-projection="${e.key}">
                        <div class="projection-preview">${e.emoji}</div>
                        <div class="projection-info">
                            <div class="projection-name">${e.name}</div>
                            <div class="projection-desc">${e.desc}</div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `,e.appendChild(this.#r),lucide.createIcons()}addEventListeners(){document.getElementById("projectionClose")?.addEventListener("click",()=>{this.#r.classList.remove("visible")}),this.#r.querySelectorAll(".projection-item").forEach(e=>{e.addEventListener("click",this.#c.bind(this,e))}),document.addEventListener("click",this.#d.bind(this))}#c(e){let t=e.dataset.projection;this.#a.changeMapProjection(t),this.#r.querySelectorAll(".projection-item").forEach(e=>e.classList.remove("active")),e.classList.add("active"),setTimeout(()=>{this.#r.classList.remove("visible")},500)}updateActiveProjection(){let e=this.#t&&this.#t.getSetting("mapProjection")||"mercator";this.#r.querySelectorAll(".projection-item").forEach(t=>{t.classList.remove("active"),t.dataset.projection===e&&t.classList.add("active")})}togglePanel(){this.#r&&(this.#r.classList.contains("visible")||this.updateActiveProjection(),this.#r.classList.toggle("visible"))}#d(e){let t=document.getElementById("projectionSwitch");this.#r.contains(e.target)||t.contains(e.target)||this.#r.classList.remove("visible")}}class r{#e;#t=window.ncop_storage;#a;#m=[{id:"streets-v12",name:"Streets",emoji:"\uD83C\uDFD9️"},{id:"satellite-streets-v12",name:"Satellite",emoji:"\uD83D\uDEF0️"},{id:"outdoors-v12",name:"Outdoors",emoji:"\uD83C\uDFD4️"},{id:"light-v11",name:"Light",emoji:"☀️"},{id:"dark-v11",name:"Dark",emoji:"\uD83C\uDF19"},{id:"satellite-v9",name:"Satellite Only",emoji:"\uD83D\uDCE1"},{id:"navigation-day-v1",name:"Navigation Day",emoji:"\uD83D\uDDFA️"},{id:"navigation-night-v1",name:"Navigation Night",emoji:"\uD83C\uDF03"}];#p;#g;constructor(e,t){this.#e=e,this.#a=t,this.#p=this.#t?this.#t.getMapStyle():"streets-v12",this.#g=!this.#t||this.#t.getLabelsState(),this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="custom-basemap-control",t.innerHTML=`
            <button id="basemapToggle" class="custom-basemap-btn" title="Change Basemap">
                <i data-lucide="layers"></i>
            </button>
            <div id="basemapPanel" class="basemap-panel">
                <div class="labels-toggle">
                    <span class="labels-toggle-text">Show Labels</span>
                    <div class="toggle-switch ${this.#g?"active":""}" id="labelsToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="basemap-list" id="basemapList">
                    ${this.#m.map(e=>`
                        <div class="basemap-item ${e.id===this.#p?"active":""}" data-style="${e.id}">
                            <div class="basemap-image">${e.emoji}</div>
                            <span class="basemap-name">${e.name}</span>
                        </div>
                    `).join("")}
                </div>
            </div>
        `,e.appendChild(t),lucide.createIcons()}addEventListeners(){let e=document.getElementById("basemapToggle"),t=document.getElementById("basemapPanel"),a=document.getElementById("labelsToggle"),o=document.getElementById("basemapList");e?.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("visible")}),a?.addEventListener("click",this.#u.bind(this)),o?.addEventListener("click",this.#h.bind(this)),document.addEventListener("click",this.#d.bind(this));let i=document.getElementById("userPanel");i&&this.#b(i)}#u(){this.#g=!this.#g,document.getElementById("labelsToggle").classList.toggle("active",this.#g),this.#t&&this.#t.saveLabelsState(this.#g),this.#a.toggleMapLabels(this.#g)}#h(e){let t=e.target.closest(".basemap-item");if(t){let e=t.dataset.style,a=document.getElementById("basemapPanel");document.querySelectorAll(".basemap-item").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),this.#e.setStyle(`mapbox://styles/mapbox/${e}`),this.#p=e,this.#t&&this.#t.saveMapStyle(e),a.classList.remove("visible"),this.#e.once("styledata",()=>{this.#g||this.#a.toggleMapLabels(!1)})}}#d(e){let t=document.getElementById("basemapToggle"),a=document.getElementById("basemapPanel");a.contains(e.target)||t.contains(e.target)||a.classList.remove("visible")}#b(e){let t=document.querySelector(".custom-basemap-control"),a=document.getElementById("basemapPanel");new MutationObserver(o=>{o.forEach(o=>{"attributes"===o.type&&"class"===o.attributeName&&(e.classList.contains("user-panel-visible")?(t.classList.add("panel-open"),a.classList.remove("visible")):t.classList.remove("panel-open"))})}).observe(e,{attributes:!0})}}var c=o("h3r7n");let d=new Map;function m(e,t,a){let o=`${e}.${t}.${a}`;return d.has(o)||d.set(o,{active:!1}),o}function p(e,t,a,o){try{let i=c.ncop_menu_items[e];if(!i)return null;let s=i[t];if(!s)return null;let l=s[o];if(!l)return null;return l[a]}catch(o){return console.error(`\u{274C} Error getting item data for ${e}.${t}.${a}:`,o),null}}class g{#v;#y;#f;#t=window.ncop_storage;constructor(){console.log("\uD83D\uDE80 SidebarMenu constructor called"),this.renderButton(),console.log("✅ Button rendered"),this.#v=document.getElementById("sidebarPanel"),console.log("\uD83D\uDD0D Sidebar panel:",this.#v),this.#f=this.#v?.querySelector(".accordion-container"),console.log("\uD83D\uDD0D Accordion container:",this.#f),this.loadSidebarConfig(),console.log("✅ Config loading started"),this.addEventListeners(),console.log("✅ Event listeners added"),console.log("\uD83D\uDCCB Sidebar menu initialized")}renderButton(){let e=document.getElementById("map");this.#y=document.createElement("div"),this.#y.className="custom-menu-control",this.#y.innerHTML=`
            <button id="menuToggle" class="custom-menu-btn" title="Open Menu">
                <i data-lucide="menu"></i>
            </button>
        `,e.appendChild(this.#y),lucide.createIcons()}addEventListeners(){document.getElementById("menuToggle")?.addEventListener("click",this.openSidebar.bind(this)),document.getElementById("sidebarCloseBtn")?.addEventListener("click",this.closeSidebar.bind(this)),document.addEventListener("keydown",this.#S.bind(this))}openSidebar(){this.#v?.classList.add("visible"),this.#y?.classList.add("hidden")}closeSidebar(){this.#v?.classList.remove("visible"),this.#y?.classList.remove("hidden")}#S(e){"Escape"===e.key&&this.#v?.classList.contains("visible")&&this.closeSidebar()}async loadSidebarConfig(){try{console.log("\uD83D\uDD0D Starting to import map-layers.js...");let{ncop_menu_items:e}=await Promise.resolve(o("h3r7n"));console.log("\uD83D\uDCCB Import successful! Menu configuration:",e),console.log("\uD83D\uDCCB Available categories:",Object.keys(e||{})),e&&Object.keys(e).length>0?(console.log("✅ Starting sidebar population..."),this.#D(e)):(console.warn("⚠️ ncop_menu_items is empty or undefined, using basic sidebar"),this.#E())}catch(e){console.error("❌ Error loading NCOP menu configuration:",e),console.error("❌ Error details:",e.message,e.stack),this.#E()}}#D(e){this.#f&&(this.#f.innerHTML="",Object.keys(e).forEach(t=>{let a=e[t],o=this.#C(t,a);this.#f.appendChild(o)}),lucide.createIcons(),this.#_(),this.#w(),setTimeout(()=>{this.#L()},100))}#P(e){return({gis_layers:{title:"GIS Layers",icon:"layers",customIcon:"/static/icons/accordion_icons/gis-layers.webp"},weather:{title:"Weather Systems",icon:"cloud",customIcon:"/static/icons/accordion_icons/weather-systems.webp"},flood:{title:"Flood Monitoring",icon:"waves",customIcon:"/static/icons/accordion_icons/flood.webp"},air_quality:{title:"Air Quality",icon:"wind",customIcon:"/static/icons/accordion_icons/air-quality.webp"},"ocean/coastal":{title:"Ocean & Coastal",icon:"anchor",customIcon:"/static/icons/accordion_icons/ocean-coastal.webp"},"Disaster Early Warning (DEW)":{title:"Early Warning",icon:"alert-triangle",customIcon:"/static/icons/accordion_icons/early-warning.webp"}})[e]||{title:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),icon:"folder"}}#C(e,t){let a=document.createElement("div");a.className="accordion-item";let o=this.#P(e),i=o.customIcon?`<img src="${o.customIcon}" alt="${o.title}" class="accordion-custom-icon">`:`<i data-lucide="${o.icon}" class="accordion-icon"></i>`,s=document.createElement("div");s.className="accordion-header",s.innerHTML=`${i}<span class="accordion-title">${o.title}</span><i data-lucide="chevron-down" class="accordion-chevron"></i>`;let l=document.createElement("div");return l.className="accordion-content",Object.keys(t).forEach(a=>{let o=t[a];l.appendChild(this.#I(e,a,o))}),a.appendChild(s),a.appendChild(l),a}#I(e,t,a){let o=document.createElement("div");o.className="ncop-subcategory";let i=document.createElement("div");i.className="ncop-subcategory-header",i.innerHTML=`<span>${t}</span><i data-lucide="chevron-right" class="subcategory-chevron"></i>`;let s=document.createElement("div");return s.className="ncop-items-container",console.log(`\u{1F50D} Rendering subcategory: ${t}`,a),Object.keys(a).forEach(o=>{let i=a[o];if(console.log(`\u{1F50D} Processing type: ${o}`,i),"toggle"===o)console.log(`\u{2705} Creating toggle items for ${o}:`,Object.keys(i)),Object.keys(i).forEach(a=>{console.log(`\u{1F50D} Creating toggle item: ${a}`,i[a]);let o=this.#T(e,t,a,i[a]);o?(console.log(`\u{2705} Created toggle element:`,o),s.appendChild(o)):console.error(`\u{274C} Failed to create toggle element for ${a}`)});else if("temporal"===o){console.log(`\u{2705} Creating temporal items for ${o}:`,Object.keys(i));let a=document.createElement("div");a.className="ncop-grid",Object.keys(i).forEach(o=>{console.log(`\u{1F50D} Creating temporal item: ${o}`,i[o]);let s=this.#k(e,t,o,i[o]);s?(console.log(`\u{2705} Created temporal element:`,s),a.appendChild(s)):console.error(`\u{274C} Failed to create temporal element for ${o}`)}),s.appendChild(a)}else if("dropdown"===o){console.log(`\u{2705} Creating dropdown item for ${o}:`,i);let a=this.#M(e,t,o,i);a?(console.log(`\u{2705} Created dropdown element:`,a),s.appendChild(a)):console.error(`\u{274C} Failed to create dropdown element for ${o}`)}else if("button"===o){console.log(`\u{2705} Creating button items for ${o}:`,Object.keys(i));let a=document.createElement("div");a.className="ncop-grid",Object.keys(i).forEach(o=>{console.log(`\u{1F50D} Creating button item: ${o}`,i[o]);let s=this.#$(e,t,o,i[o]);s?(console.log(`\u{2705} Created button element:`,s),a.appendChild(s)):console.error(`\u{274C} Failed to create button element for ${o}`)}),s.appendChild(a)}else console.warn(`\u{26A0}\u{FE0F} Unknown item type: ${o}`,i)}),i.addEventListener("click",function(){let e=this.classList.contains("expanded"),t=this.closest(".accordion-content"),a=t?.querySelectorAll(".ncop-subcategory-header");a?.forEach(e=>{e!==this&&(e.classList.remove("expanded"),e.nextElementSibling?.classList.remove("visible"))}),e?(this.classList.remove("expanded"),s.classList.remove("visible")):(this.classList.add("expanded"),s.classList.add("visible"))}),o.appendChild(i),o.appendChild(s),o}#T(e,t,a,o){if(console.log(`\u{1F527} Creating toggle item: ${a}`,o),!o||!o.label)return console.error(`\u{274C} Invalid toggle item data for ${a}:`,o),null;let i=document.createElement("div");return i.className="ncop-item ncop-item-toggle",i.innerHTML=`
            <span class="ncop-item-label">${o.label}</span>
            <label class="ncop-toggle">
                <input type="checkbox" data-item-key="${a}">
                <span class="ncop-toggle-slider"></span>
            </label>
        `,i.querySelector('input[type="checkbox"]').addEventListener("change",o=>{var i=o.target.checked;let s=m(e,t,a),l=p(e,t,a,"toggle");d.set(s,{active:i}),console.log("\uD83D\uDD04 TOGGLE INTERACTION:",{category:e,subcategory:t,itemKey:a,itemData:l,active:i,stateKey:s})}),console.log(`\u{2705} Toggle item created successfully:`,i),i}#k(e,t,a,o){if(console.log(`\u{1F527} Creating temporal item: ${a}`,o),!o||!o.label)return console.error(`\u{274C} Invalid temporal item data for ${a}:`,o),null;let i=document.createElement("div");i.className="ncop-item ncop-item-temporal",i.innerHTML=`
            <div class="ncop-item-image">
                <img src="${o.image||"/static/images/placeholder.png"}" alt="${o.label}" />
            </div>
            <span class="ncop-item-label">${o.label}</span>
        `;let s=i.querySelector(".ncop-item-image");return s.addEventListener("click",o=>{o.stopPropagation();let i=s.classList.contains("selected");this.#j(s);var l=!i;let n=m(e,t,a),r=p(e,t,a,"temporal");d.set(n,{active:l}),console.log("\uD83D\uDDBC️ TEMPORAL INTERACTION:",{category:e,subcategory:t,itemKey:a,itemData:r,active:l,stateKey:n})}),console.log(`\u{2705} Temporal item created successfully:`,i),i}#M(e,t,a,o){if(console.log(`\u{1F527} Creating dropdown item: ${a}`,o),!o)return console.error(`\u{274C} Invalid dropdown item data for ${a}:`,o),null;let i=document.createElement("div");i.className="ncop-item ncop-item-dropdown";let s=o.endpoint||"",l=o.key||"id",n=o.attribute||"label";if(console.log(`\u{1F50D} Dropdown config - endpoint: ${s}, key: ${l}, attribute: ${n}`),o.image){i.innerHTML=`
                <div class="ncop-item-image">
                    <img src="${o.image}" alt="${o.label||"Dropdown"}" />
                </div>
                <select class="ncop-dropdown" data-endpoint="${s}" data-key-field="${l}" data-attribute-field="${n}" data-item-key="${a}">
                    <option selected>Loading...</option>
                </select>
            `;let e=i.querySelector(".ncop-item-image");e.addEventListener("click",t=>{t.stopPropagation(),this.#j(e)})}else i.innerHTML=`
                <select class="ncop-dropdown" data-endpoint="${s}" data-key-field="${l}" data-attribute-field="${n}" data-item-key="${a}">
                    <option selected>Loading...</option>
                </select>
            `;return setTimeout(()=>{let o=i.querySelector("select");if(!s){console.warn(`\u{26A0}\u{FE0F} No endpoint provided for dropdown ${a}`),o.innerHTML="<option selected disabled>No endpoint</option>";return}console.log(`\u{1F4E1} Fetching dropdown data from: ${s}`),fetch(s).then(e=>e.json()).then(i=>{console.log(`\u{1F4CA} Dropdown data for ${a}:`,i),o.innerHTML="<option selected disabled>Select an option</option>",i.forEach(e=>{console.log(`\u{1F50D} Processing row:`,e);let t=e[l],a=e[n];console.log(`\u{2705} Value: ${t}, Label: ${a}`),o.innerHTML+=`<option value="${t}">${a}</option>`}),o.addEventListener("change",a=>{let o=a.target.value,i=a.target.options[a.target.selectedIndex]?.text,s=m(e,t,"dropdown"),l=p(e,t,"dropdown","dropdown"),n=o&&""!==o;d.set(s,{active:n,selectedValue:o,selectedLabel:i}),console.log("\uD83D\uDCCB DROPDOWN INTERACTION:",{category:e,subcategory:t,itemKey:"dropdown",itemData:l,active:n,selectedValue:o,selectedLabel:i,stateKey:s})})}).catch(e=>{console.error(`\u{274C} Dropdown fetch error for ${a}:`,e),o.innerHTML="<option selected disabled>Error loading data</option>"})},0),console.log(`\u{2705} Dropdown item created successfully:`,i),i}#$(e,t,a,o){if(console.log(`\u{1F527} Creating button item: ${a}`,o),!o||!o.label)return console.error(`\u{274C} Invalid button item data for ${a}:`,o),null;let i=document.createElement("div");i.className="ncop-item ncop-item-button";let s=o.color||"#6366f1",l=o.outline||"#4f46e5";if(i.style.setProperty("--button-color",s),i.style.setProperty("--border-color",l),o.image){i.innerHTML=`
                <div class="ncop-item-content">
                    <div class="ncop-item-image">
                        <img src="${o.image}" alt="${o.label}" />
                    </div>
                    <span class="ncop-item-label">${o.label}</span>
                </div>
                <label class="ncop-toggle">
                    <input type="checkbox" data-item-key="${a}">
                    <span class="ncop-toggle-slider"></span>
                </label>
            `;let e=i.querySelector(".ncop-item-image");e.addEventListener("click",t=>{t.stopPropagation(),this.#j(e)})}else i.innerHTML=`
                <span class="ncop-item-label">${o.label}</span>
                <label class="ncop-toggle">
                    <input type="checkbox" data-item-key="${a}">
                    <span class="ncop-toggle-slider"></span>
                </label>
            `;return i.querySelector('input[type="checkbox"]').addEventListener("change",o=>{var i=e,s=t,l=a;let n=m(i,s,l),r=p(i,s,l,"button"),c=!d.get(n).active;d.set(n,{active:c}),console.log("\uD83D\uDD18 BUTTON INTERACTION:",{category:i,subcategory:s,itemKey:l,itemData:r,active:c,stateKey:n})}),console.log(`\u{2705} Button item created successfully:`,i),i}#j(e){let t=e.classList.contains("selected");document.querySelectorAll(".ncop-item-image.selected").forEach(e=>{e.classList.remove("selected")}),t||e.classList.add("selected"),console.log(`\u{1F5BC}\u{FE0F} Image selection updated for:`,e)}#_(){document.querySelectorAll(".accordion-header").forEach(e=>{e.addEventListener("click",function(){let e=this.nextElementSibling,t=this.classList.contains("active");document.querySelectorAll(".accordion-header").forEach(e=>{e!==this&&(e.classList.remove("active"),e.nextElementSibling?.classList.remove("expanded"))}),this.classList.toggle("active",!t),e?.classList.toggle("expanded",!t)})})}#E(){this.#f&&(this.#f.innerHTML=`
            <div class="accordion-item">
                <div class="accordion-header">
                    <i data-lucide="settings"></i>
                    <span>System Menu</span>
                    <i data-lucide="chevron-down" class="accordion-chevron"></i>
                </div>
                <div class="accordion-content">
                    <ul class="accordion-items">
                        <li class="accordion-item-entry" data-action="exportData">
                            <i data-lucide="download"></i><span>Export Settings</span>
                        </li>
                        <li class="accordion-item-entry" data-action="showHelp">
                            <i data-lucide="help-circle"></i><span>Help & Support</span>
                        </li>
                    </ul>
                </div>
            </div>
        `,this.#_(),lucide.createIcons())}#F(e,t,a){console.log(`\u{1F504} NCOP Toggle - ${t}:`,{endpoint:e,enabled:a}),this.#t&&this.#t.saveSetting(`ncop_toggle_${t}`,a);let o=a?"enabled":"disabled";console.log(`\u{1F4E1} ${t} has been ${o}`)}#x(e,t,a){if(console.log(`\u{1F4CB} NCOP Dropdown - ${t}:`,{endpoint:e,value:a}),this.#t&&this.#t.saveSetting(`ncop_dropdown_${t}`,a),""===a)return void console.log(`\u{1F4CB} ${t} selection cleared`);console.log(`\u{1F4CA} ${t} set to: ${a}`)}#L(){this.#t&&(document.querySelectorAll('.ncop-toggle input[type="checkbox"]').forEach(e=>{let t=e.dataset.itemKey,a=this.#t.getSetting(`ncop_toggle_${t}`);null!==a&&(e.checked=a)}),document.querySelectorAll(".ncop-dropdown").forEach(e=>{let t=e.dataset.itemKey,a=this.#t.getSetting(`ncop_dropdown_${t}`);null!==a&&(e.value=a)}),console.log("\uD83D\uDD04 NCOP control states restored from localStorage"))}#w(){let e=document.getElementById("sidebarSearch"),t=document.getElementById("clearSearch");e&&t&&(e.addEventListener("input",e=>{let a=e.target.value.toLowerCase().trim();a?(t.style.display="flex",this.#q(a)):(t.style.display="none",this.#B())}),t.addEventListener("click",()=>{e.value="",t.style.display="none",this.#B()}))}#q(e){let t=this.#f;if(!t)return;let a=0;t.querySelectorAll(".accordion-item").forEach(t=>{let o=!1,i=t.querySelector(".accordion-header"),s=t.querySelector(".accordion-content"),l=i.querySelector("span"),n=l?.textContent.toLowerCase()||"",r=n.includes(e);r&&(o=!0);let c=t.querySelectorAll(".ncop-subcategory"),d=0;c.forEach(t=>{let a=!1,i=t.querySelector(".ncop-subcategory-header"),s=i?.querySelector("span"),l=s?s.textContent.toLowerCase():"",r=t.querySelector(".ncop-items-container");l.includes(e)&&(a=!0,o=!0);let c=t.querySelectorAll(".ncop-item"),m=0;c.forEach(t=>{let i=t.querySelector(".ncop-item-label"),s=i?i.textContent.toLowerCase():"",r=t.querySelector('input[type="checkbox"]'),c=t.querySelector("select");[s,r&&r.dataset.endpoint||"",c&&c.dataset.endpoint||"",l,n].join(" ").toLowerCase().includes(e)?(t.style.display="flex",m++,a=!0,o=!0,this.#A(i,e)):(t.style.display="none",this.#O(i))}),a?(t.style.display="block",d++,l.includes(e)?this.#A(s,e):this.#O(s),r&&i&&m>0&&(r.classList.add("visible"),i.classList.add("expanded"))):(t.style.display="none",this.#O(s))}),o?(t.style.display="block",a++,s&&d>0&&(s.classList.add("expanded"),i.classList.add("active")),r&&l?this.#A(l,e):l&&this.#O(l)):(t.style.display="none",l&&this.#O(l))}),0===a?this.#N():this.#H()}#B(){let e=this.#f;e&&(e.querySelectorAll(".accordion-item").forEach(e=>{e.style.display="block";let t=e.querySelector(".accordion-header"),a=e.querySelector(".accordion-content"),o=t.querySelector("span");this.#O(o),t.classList.remove("active"),a.classList.remove("expanded"),e.querySelectorAll(".ncop-subcategory").forEach(e=>{e.style.display="block";let t=e.querySelector(".ncop-subcategory-header"),a=t?.querySelector("span"),o=e.querySelector(".ncop-items-container");this.#O(a),t?.classList.remove("expanded"),o?.classList.remove("visible"),e.querySelectorAll(".ncop-item").forEach(e=>{e.style.display="flex";let t=e.querySelector(".ncop-item-label");this.#O(t)})})}),this.#H())}#A(e,t){if(!e||!t)return;this.#O(e);let a=e.textContent,o=RegExp(`(${t})`,"gi");e.innerHTML=a.replace(o,'<span class="search-highlight">$1</span>')}#O(e){if(e&&(e.querySelectorAll(".search-highlight").forEach(e=>{let t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}),e.classList.contains("search-highlight"))){let t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}}#N(){if(this.#H(),this.#f){let e=document.createElement("div");e.className="no-results-message",e.innerHTML="<p>No results found</p><small>Try different keywords or check spelling</small>",this.#f.appendChild(e),lucide.createIcons()}}#H(){document.querySelector(".no-results-message")?.remove()}}class u{#t=window.ncop_storage;constructor(){this.#R(),this.#z(),this.#U()}#R(){window.ncop_utils={exportSettings:this.exportSettings.bind(this),importSettings:this.importSettings.bind(this),clearAllData:this.clearAllData.bind(this),showStorageInfo:this.showStorageInfo.bind(this),resetToDefaults:this.resetToDefaults.bind(this)}}#z(){document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.shiftKey)switch(e.key){case"E":e.preventDefault(),this.exportSettings();break;case"I":e.preventDefault(),this.importSettings();break;case"D":e.preventDefault(),this.showStorageInfo()}})}#U(){console.log("\uD83D\uDD27 NCOP Utilities loaded. Available commands: (ncop_utils.[command])")}exportSettings(){if(this.#t){let e=new Blob([this.#t.exportSettings()],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`ncop-settings-${new Date().toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(t),console.log("\uD83D\uDCE5 Settings exported")}}importSettings(){let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{let t=e.target.result;this.#t&&this.#t.importSettings(t)?alert("Settings imported successfully! Please refresh the page."):alert("Failed to import settings. Please check the file format.")},e.readAsText(t)}},e.click()}clearAllData(){confirm("Are you sure you want to clear all saved data? This cannot be undone.")&&this.#t&&(this.#t.clearUserData(),alert("All data cleared! Please refresh the page."))}showStorageInfo(){if(this.#t){let e=this.#t.getStorageInfo();console.table(e),alert(`
Storage Information:
- Total Keys: ${e.totalKeys}
- Total Size: ${e.sizeKB} KB
- Max Size: ${e.maxSize}
- User: ${window.USERNAME||"Guest"}
            `)}}resetToDefaults(){confirm("Reset all settings to defaults? This will clear your preferences.")&&this.#t&&(this.#t.clearUserData(),this.#t.initializeUserSettings(),alert("Settings reset to defaults! Please refresh the page."))}}class h{constructor(){this.render(),this.addEventListeners()}render(){let e=document.getElementById("map"),t=document.createElement("div");t.className="custom-user-control",t.innerHTML=`
            <button id="userToggle" class="custom-user-btn" title="User Info">
                <i data-lucide="user"></i>
            </button>
        `,e.appendChild(t),lucide.createIcons()}addEventListeners(){let e=document.getElementById("userToggle"),t=document.getElementById("userPanel");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("user-panel-visible")}),document.addEventListener("click",function(a){t.contains(a.target)||e.contains(a.target)||t.classList.remove("user-panel-visible")}))}}window.ncop_storage=null,i.isAvailable()?window.ncop_storage=new i:console.warn("⚠️ LocalStorage not available - user preferences will not be saved");class b{#e;#t=window.ncop_storage;#a;init(){if(!window.MAPBOX_ACCESS_TOKEN)return void console.error("Mapbox access token not found. Please check your environment configuration.");mapboxgl.accessToken=window.MAPBOX_ACCESS_TOKEN,this.#K(),this.#e.on("load",this.#W.bind(this)),this.#e.on("moveend",this.#G.bind(this)),this.#e.on("error",e=>console.error("Map error:",e)),this.#a=new s(this.#e,this.#t);let e=new n(this.#e,this.#a);new l(this.#e,this.#a,e),new h,new r(this.#e,this.#a),new g,new u,this.#t&&this.#t.updateLastLogin(),console.log("Dashboard initialized using a modular, class-based structure.")}#K(){let e=this.#t?this.#t.getMapStyle():"streets-v12",t=this.#t?this.#t.getSetting("mapCenter"):[74.3,31.5],a=this.#t?this.#t.getSetting("mapZoom"):6,o=this.#t?this.#t.getSetting("mapProjection"):"mercator";this.#e=new mapboxgl.Map({container:"map",style:`mapbox://styles/mapbox/${e}`,center:t,zoom:a,projection:o||"mercator",hash:!0})}#W(){if(console.log("Map loaded successfully"),this.#t){let e=this.#t.getSetting("mapBearing"),t=this.#t.getSetting("mapPitch"),a=this.#t.getSetting("mapProjection"),o=this.#t.getSetting("terrainEnabled"),i=this.#t.getLabelsState();(null!==e||null!==t)&&(this.#e.setBearing(e||0),this.#e.setPitch(t||0)),a&&"mercator"!==a&&setTimeout(()=>{this.#a.changeMapProjection(a)},500),o&&setTimeout(()=>{this.#a.enableTerrain()},800),i||setTimeout(()=>{this.#a.toggleMapLabels(!1)},1e3)}}#G(){this.#t&&this.#t.saveMapState(this.#e)}}document.addEventListener("DOMContentLoaded",function(){lucide.createIcons(),new b().init()})})();
//# sourceMappingURL=dashboard.js.map
